<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢¨åŠ›ç™¼é›»ç‰©ç†æ¨¡å‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- åŠ å…¥ MathJax ç”¨æ–¼é¡¯ç¤º LaTeX å…¬å¼ -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

    <style>
        /* è‡ªå®šç¾©æ»‘æ¡¿æ¨£å¼ */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #34d399; /* emerald-400 */
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 0 2px rgba(0,0,0,0.5);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #4b5563; /* gray-600 */
            border-radius: 2px;
        }

        input[type=range]:focus {
            outline: none;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen flex flex-col font-sans">

    <!-- Header -->
    <header class="bg-slate-800 p-4 border-b border-slate-700 shadow-lg">
        <div class="container mx-auto flex items-center justify-between">
            <h1 class="text-2xl font-bold text-emerald-400">ğŸŒ¬ï¸ é¢¨èƒ½ç™¼é›»ç‰©ç†æ¨¡å‹</h1>
            <span class="text-sm text-slate-400 hidden sm:block">ç‰©ç†æ•™å­¸äº’å‹•æ•™å…·</span>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto p-4 flex flex-col lg:flex-row gap-6">
        
        <!-- Left Column: Controls & Data -->
        <div class="w-full lg:w-1/3 flex flex-col gap-6">
            
            <!-- Controls Card -->
            <div class="bg-slate-800 p-6 rounded-xl shadow-xl border border-slate-700">
                <h2 class="text-xl font-semibold mb-4 text-emerald-300 border-b border-slate-600 pb-2">åƒæ•¸è¨­å®š</h2>
                
                <!-- Slider 1: Wind Speed -->
                <div class="mb-6">
                    <div class="flex justify-between mb-2">
                        <label class="text-sm font-medium text-slate-300">é¢¨é€Ÿ ($v$)</label>
                        <span class="text-emerald-400 font-mono"><span id="val-speed">10.0</span> m/s</span>
                    </div>
                    <input type="range" id="slider-speed" min="0" max="30" step="0.1" value="10.0" class="w-full">
                </div>

                <!-- Slider 2: Blade Length -->
                <div class="mb-6">
                    <div class="flex justify-between mb-2">
                        <label class="text-sm font-medium text-slate-300">æ‰‡è‘‰é•·åº¦/åŠå¾‘ ($r$)</label>
                        <span class="text-emerald-400 font-mono"><span id="val-length">15.0</span> m</span>
                    </div>
                    <input type="range" id="slider-length" min="1" max="30" step="0.5" value="15.0" class="w-full">
                </div>

                <!-- Slider 3: Air Density -->
                <div class="mb-6">
                    <div class="flex justify-between mb-2">
                        <label class="text-sm font-medium text-slate-300">ç©ºæ°£å¯†åº¦ ($\rho$)</label>
                        <span class="text-emerald-400 font-mono"><span id="val-density">1.225</span> kg/mÂ³</span>
                    </div>
                    <input type="range" id="slider-density" min="1.0" max="1.4" step="0.001" value="1.225" class="w-full">
                    <p class="text-xs text-slate-500 mt-1">*æ¨™æº–å¤§æ°£å£“ç´„ç‚º 1.225 kg/mÂ³</p>
                </div>

                <!-- Slider 4: Efficiency -->
                <div class="mb-2">
                    <div class="flex justify-between mb-2">
                        <label class="text-sm font-medium text-slate-300">ç³»çµ±ç¸½æ•ˆç‡ ($\eta$)</label>
                        <span class="text-emerald-400 font-mono"><span id="val-efficiency">30</span>%</span>
                    </div>
                    <!-- Update: Max efficiency increased to 60% -->
                    <input type="range" id="slider-efficiency" min="0" max="60" step="1" value="30" class="w-full">
                    <p class="text-xs text-slate-500 mt-1">*Betz æ¥µé™ç†è«–ä¸Šé™ç´„ 59.3%</p>
                </div>
            </div>

            <!-- Physics & Calculation Card -->
            <div class="bg-slate-800 p-6 rounded-xl shadow-xl border border-slate-700 flex-grow flex flex-col justify-center">
                <h2 class="text-xl font-semibold mb-4 text-blue-300 border-b border-slate-600 pb-2">åŠŸç‡è¨ˆç®—</h2>
                
                <div class="mb-4 bg-slate-900 p-3 rounded border border-slate-600 flex flex-col items-center justify-center min-h-[100px]">
                    <p class="text-lg mb-2">
                        $$P = \frac{1}{2} \rho A v^3 \eta$$
                    </p>
                    <p class="text-sm text-slate-400">
                        $$A = \pi r^2 \text{ (æƒæ é¢ç©)}$$
                    </p>
                </div>

                <div class="space-y-2 text-sm text-slate-300 mb-4">
                    <div class="flex justify-between items-center">
                        <span>æƒæ é¢ç© ($A$):</span>
                        <span class="font-mono text-blue-200"><span id="display-area">0</span> mÂ²</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>é¢¨èƒ½åŠŸç‡ ($P_{wind}$):</span>
                        <span class="font-mono text-blue-200"><span id="display-wind-power">0</span></span>
                    </div>
                </div>

                <div class="mt-auto bg-emerald-900/30 border border-emerald-500/50 p-4 rounded-lg text-center">
                    <h3 class="text-emerald-200 text-sm uppercase tracking-wider mb-1">è¼¸å‡ºåŠŸç‡ Output Power</h3>
                    <p class="text-4xl font-bold text-emerald-400 font-mono" id="display-output">0 kW</p>
                </div>
            </div>

        </div>

        <!-- Right Column: Animation -->
        <div class="w-full lg:w-2/3 bg-black rounded-xl shadow-2xl overflow-hidden relative border border-slate-600 h-[500px] lg:h-auto">
            <!-- Overlay Info -->
            <div class="absolute top-4 right-4 bg-black/50 backdrop-blur px-3 py-1 rounded text-xs text-slate-400 z-10 pointer-events-none">
                è¦–è¦ºæ¨¡æ“¬ Visual Simulation
            </div>
            
            <canvas id="simCanvas" class="w-full h-full block"></canvas>
        </div>
    </main>

    <script>
        // --- å¸¸æ•¸èˆ‡è®Šæ•¸åˆå§‹åŒ– ---
        const PI = Math.PI;
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');

        // DOM å…ƒç´ 
        const inputs = {
            speed: document.getElementById('slider-speed'),
            length: document.getElementById('slider-length'),
            density: document.getElementById('slider-density'),
            efficiency: document.getElementById('slider-efficiency')
        };

        const displays = {
            speed: document.getElementById('val-speed'),
            length: document.getElementById('val-length'),
            density: document.getElementById('val-density'),
            efficiency: document.getElementById('val-efficiency'),
            area: document.getElementById('display-area'),
            windPower: document.getElementById('display-wind-power'),
            output: document.getElementById('display-output')
        };

        // æ¨¡æ“¬ç‹€æ…‹
        let state = {
            v: parseFloat(inputs.speed.value),      // é¢¨é€Ÿ m/s
            r: parseFloat(inputs.length.value),     // åŠå¾‘ m
            rho: parseFloat(inputs.density.value),  // å¯†åº¦ kg/m^3
            eta: parseFloat(inputs.efficiency.value), // æ•ˆç‡ %
            angle: 0,                               // æ‰‡è‘‰è§’åº¦
            particles: []                           // é¢¨ç²’å­é™£åˆ—
        };

        // --- ç‰©ç†è¨ˆç®—åŠŸèƒ½ ---
        function calculate() {
            // 1. æ›´æ–°ç‹€æ…‹
            state.v = parseFloat(inputs.speed.value);
            state.r = parseFloat(inputs.length.value);
            state.rho = parseFloat(inputs.density.value);
            state.eta = parseFloat(inputs.efficiency.value);

            // 2. æ›´æ–° UI æ•¸å€¼é¡¯ç¤º
            displays.speed.textContent = state.v.toFixed(1);
            displays.length.textContent = state.r.toFixed(1);
            displays.density.textContent = state.rho.toFixed(3);
            displays.efficiency.textContent = state.eta.toFixed(0);

            // 3. ç‰©ç†è¨ˆç®—
            const area = PI * Math.pow(state.r, 2);
            const etaDecimal = state.eta / 100;
            
            // é¢¨ä¸­è˜Šå«çš„ç¸½åŠŸç‡ P_wind = 0.5 * rho * A * v^3
            const rawWindPower = 0.5 * state.rho * area * Math.pow(state.v, 3);
            
            // å¯¦éš›è¼¸å‡ºåŠŸç‡
            const outputPower = rawWindPower * etaDecimal;

            // 4. é¡¯ç¤ºè¨ˆç®—çµæœ (Area)
            displays.area.textContent = area.toFixed(1);

            // æ ¼å¼åŒ–åŠŸç‡é¡¯ç¤º (W -> kW -> MW)
            displays.windPower.textContent = formatPower(rawWindPower);
            displays.output.textContent = formatPower(outputPower);
        }

        function formatPower(watts) {
            if (watts >= 1000000) {
                return (watts / 1000000).toFixed(2) + " MW";
            } else if (watts >= 1000) {
                return (watts / 1000).toFixed(2) + " kW";
            } else {
                return watts.toFixed(1) + " W";
            }
        }

        // --- Canvas å‹•ç•«åŠŸèƒ½ ---

        // åˆå§‹åŒ–ç²’å­
        function initParticles() {
            for(let i=0; i<50; i++) {
                state.particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    len: Math.random() * 20 + 10,
                    speedOffset: Math.random() * 0.5 + 0.8
                });
            }
        }

        // èª¿æ•´ Canvas å¤§å°
        function resizeCanvas() {
            const parent = canvas.parentElement;
            canvas.width = parent.clientWidth;
            canvas.height = parent.clientHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas(); // åˆå§‹å‘¼å«
        initParticles(); // åˆå§‹ç²’å­

        function draw() {
            // æ¸…é™¤èƒŒæ™¯
            ctx.fillStyle = '#0f172a'; // slate-900
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const centerX = canvas.width * 0.6; // ç™¼é›»æ©Ÿç¨å¾®é å³
            const centerY = canvas.height * 0.6; // åœ°é¢åœ¨ä¸‹æ–¹ï¼Œä¸­å¿ƒç¨å¾®é ä¸‹
            
            // è¦–è¦ºæ¯”ä¾‹ç¸®æ”¾å› å­ (å°‡çœŸå¯¦ç±³æ•¸è½‰æ›ç‚ºåƒç´ )
            // å‡è¨­æœ€å¤§ 30m åŠå¾‘ä½”æ“šç•«é¢çš„ 40% é«˜åº¦
            const scaleFactor = (canvas.height * 0.4) / 30; 
            const visualRadius = state.r * scaleFactor;
            const hubRadius = visualRadius * 0.1 > 5 ? visualRadius * 0.1 : 5;

            // --- 1. ç¹ªè£½é¢¨ç²’å­ (èƒŒæ™¯) ---
            ctx.strokeStyle = `rgba(167, 243, 208, ${state.rho - 0.8})`; // é¡è‰²éš¨å¯†åº¦å¾®èª¿é€æ˜åº¦
            ctx.lineWidth = 1;
            
            // ç²’å­ç§»å‹•é€Ÿåº¦ä¿‚æ•¸ (è¦–è¦ºç”¨)
            const particleSpeed = state.v * 0.5; 

            state.particles.forEach(p => {
                ctx.beginPath();
                ctx.moveTo(p.x, p.y);
                ctx.lineTo(p.x + p.len, p.y);
                ctx.stroke();

                // ç§»å‹•
                p.x += particleSpeed * p.speedOffset;

                // å¾ªç’°
                if (p.x > canvas.width) {
                    p.x = -50;
                    p.y = Math.random() * canvas.height;
                }
            });

            // --- 2. ç¹ªè£½å¡”æ¶ ---
            const towerWidthTop = hubRadius * 1.5;
            const towerWidthBottom = hubRadius * 3;
            
            const gradTower = ctx.createLinearGradient(centerX - 20, 0, centerX + 20, 0);
            gradTower.addColorStop(0, '#334155');
            gradTower.addColorStop(0.5, '#64748b');
            gradTower.addColorStop(1, '#334155');

            ctx.fillStyle = gradTower;
            ctx.beginPath();
            ctx.moveTo(centerX - towerWidthTop/2, centerY);
            ctx.lineTo(centerX + towerWidthTop/2, centerY);
            ctx.lineTo(centerX + towerWidthBottom/2, canvas.height);
            ctx.lineTo(centerX - towerWidthBottom/2, canvas.height);
            ctx.closePath();
            ctx.fill();

            // --- 3. ç¹ªè£½æ—‹è½‰çš„æ‰‡è‘‰ ---
            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(state.angle);

            // æ‰‡è‘‰æ¨£å¼
            const bladeColor = '#f1f5f9'; // slate-100
            ctx.fillStyle = bladeColor;
            ctx.shadowColor = 'rgba(0,0,0,0.5)';
            ctx.shadowBlur = 10;

            for (let i = 0; i < 3; i++) {
                ctx.beginPath();
                // ç¹ªè£½å–®å€‹æ‰‡è‘‰ (é¡ä¼¼æ©Ÿç¿¼å½¢ç‹€)
                ctx.moveTo(0, 0);
                ctx.quadraticCurveTo(hubRadius, 0, hubRadius, -hubRadius/2);
                ctx.lineTo(visualRadius, -hubRadius/4); // å°–ç«¯
                ctx.lineTo(visualRadius, hubRadius/4);  // å°–ç«¯
                ctx.quadraticCurveTo(hubRadius, hubRadius/2, 0, 0);
                ctx.fill();
                
                // æ—‹è½‰ 120 åº¦
                ctx.rotate((2 * Math.PI) / 3);
            }

            // æ¢å¾©é™°å½±è¨­å®š
            ctx.shadowBlur = 0;
            ctx.restore();

            // --- 4. ç¹ªè£½ä¸­å¿ƒè»¸ (Hub) ---
            ctx.beginPath();
            ctx.arc(centerX, centerY, hubRadius, 0, Math.PI * 2);
            const gradHub = ctx.createRadialGradient(centerX, centerY, 2, centerX, centerY, hubRadius);
            gradHub.addColorStop(0, '#e2e8f0');
            gradHub.addColorStop(1, '#94a3b8');
            ctx.fillStyle = gradHub;
            ctx.fill();

            // --- æ›´æ–°æ—‹è½‰è§’åº¦ ---
            // è½‰é€Ÿèˆ‡é¢¨é€Ÿæˆæ­£æ¯” (é€™åªæ˜¯ä¸€å€‹è¦–è¦ºè¿‘ä¼¼ï¼ŒçœŸå¯¦ç‰©ç†æ›´è¤‡é›œ)
            // ç•¶é¢¨é€Ÿç‚º0æ™‚ä¸è½‰
            if(state.v > 0) {
                // ç°¡å–®æ¨¡æ“¬ï¼šè§’é€Ÿåº¦ = é¢¨é€Ÿ * å¸¸æ•¸ / åŠå¾‘ (åŠå¾‘å¤§è½‰å¾—æ…¢)
                // ç‚ºäº†è¦–è¦ºæ•ˆæœï¼ŒåŠ ä¸€å€‹åŸºç¤èª¿æ•´å€¼
                const angularVelocity = (state.v * 0.05) / (Math.sqrt(state.r) * 0.3);
                state.angle += angularVelocity;
            }

            requestAnimationFrame(draw);
        }

        // --- äº‹ä»¶ç›£è½ ---
        Object.values(inputs).forEach(input => {
            input.addEventListener('input', calculate);
        });

        // å•Ÿå‹•
        calculate();
        draw();

    </script>
</body>
</html>