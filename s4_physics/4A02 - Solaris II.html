<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solaris II: Planetary Energy Balance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;700&display=swap');

        :root {
            --space-bg: #0b0c10;
            --panel-bg: rgba(31, 41, 55, 0.7);
            --accent-blue: #38bdf8;
            --accent-orange: #fb923c;
            --accent-green: #4ade80;
        }

        body {
            background-color: var(--space-bg);
            color: #e5e5e5;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
        }

        /* --- Advanced Planet Visuals --- */
        .planet-container {
            position: relative;
            width: 220px;
            height: 220px;
            z-index: 10;
        }

        .planet-surface {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #3b82f6, #1e3a8a);
            box-shadow: inset -30px -30px 60px rgba(0,0,0,0.9);
            overflow: hidden; /* Clips the ice caps */
            position: relative;
            transition: filter 0.5s ease;
        }

        /* Continents (Simple CSS Shapes) */
        .continent {
            position: absolute;
            background-color: #15803d; /* Green-700 */
            border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
            opacity: 0.8;
            filter: blur(1px);
            transition: background-color 1s ease;
        }

        /* Ice Caps - Dynamic Height */
        .ice-cap {
            position: absolute;
            left: 0; width: 100%;
            background: #f8fafc; /* Slate-50 */
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
            transition: height 1s cubic-bezier(0.4, 0, 0.2, 1), opacity 1s ease;
            z-index: 20;
        }
        .ice-top { top: 0; border-radius: 50% 50% 100% 100% / 20%; }
        .ice-bottom { bottom: 0; border-radius: 100% 100% 50% 50% / 20%; }

        /* Atmosphere */
        .atmosphere {
            position: absolute;
            inset: -20px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(56, 189, 248, 0.1) 40%, rgba(0,0,0,0) 70%);
            box-shadow: 0 0 30px rgba(56, 189, 248, 0.2);
            z-index: 5;
            transition: opacity 0.5s, background 0.5s;
            pointer-events: none;
        }

        /* Greenhouse Gas Layer Visual */
        .greenhouse-layer {
            position: absolute;
            inset: -5px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.1);
            opacity: 0;
            transition: opacity 0.5s, border-color 0.5s;
            z-index: 6;
        }

        /* --- Canvas --- */
        #sim-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* --- UI --- */
        .hud-panel {
            background: var(--panel-bg);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            margin-bottom: 0.5rem;
            color: #94a3b8;
        }
        .stat-val { font-family: 'JetBrains Mono', monospace; color: white; }

        input[type=range] {
            width: 100%;
            height: 4px;
            background: #374151;
            border-radius: 2px;
            appearance: none;
            cursor: pointer;
        }
        input[type=range]::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: #60a5fa;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(96, 165, 250, 0.5);
            transition: transform 0.2s;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }

    </style>
</head>
<body class="h-screen w-screen flex flex-col md:flex-row">

    <!-- LEFT: Simulation Viewport -->
    <main class="flex-1 relative flex flex-col items-center justify-center overflow-hidden bg-black">
        <!-- Starfield -->
        <div class="absolute inset-0 opacity-40" style="background-image: radial-gradient(white 1px, transparent 1px); background-size: 40px 40px;"></div>
        
        <canvas id="sim-canvas"></canvas>

        <!-- Solar Source (Left off-screen hint) -->
        <div class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 w-64 h-64 bg-orange-400 rounded-full blur-[100px] opacity-30 animate-pulse"></div>

        <!-- The Earth Model -->
        <div class="planet-container">
            <div id="atmosphere" class="atmosphere"></div>
            <div id="greenhouse-layer" class="greenhouse-layer"></div>
            
            <div id="planet-surface" class="planet-surface">
                <!-- Continents -->
                <div class="continent w-16 h-20 top-8 left-8"></div>
                <div class="continent w-24 h-24 bottom-10 right-4 bg-green-800"></div>
                <div class="continent w-10 h-10 top-12 right-10"></div>

                <!-- Dynamic Ice Caps -->
                <div id="ice-north" class="ice-cap ice-top h-0"></div>
                <div id="ice-south" class="ice-cap ice-bottom h-0"></div>
            </div>
        </div>

        <!-- Floating Labels -->
        <div class="absolute bottom-10 flex gap-8 text-xs uppercase tracking-widest opacity-50 font-mono">
            <div class="flex items-center gap-2"><div class="w-2 h-2 rounded-full bg-yellow-300"></div>Incoming</div>
            <div class="flex items-center gap-2"><div class="w-2 h-2 rounded-full bg-white"></div>Reflected</div>
            <div class="flex items-center gap-2"><div class="w-2 h-2 rounded-full bg-red-500"></div>Infrared (Heat)</div>
        </div>
    </main>

    <!-- RIGHT: Control Center -->
    <aside class="w-full md:w-96 hud-panel z-20 flex flex-col overflow-y-auto h-full">
        
        <div class="p-6 border-b border-white/10">
            <h1 class="text-xl font-bold text-white flex items-center gap-2">
                <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                Solaris II <span class="text-xs font-normal text-gray-500 ml-1">Physics Engine</span>
            </h1>
        </div>

        <!-- MAIN READOUT -->
        <div class="p-6 bg-blue-900/20 border-b border-white/10">
            <div class="text-xs text-blue-300 uppercase tracking-wider mb-1 font-semibold">Surface Temperature</div>
            <div class="flex items-baseline gap-3">
                <span id="display-temp-c" class="text-5xl font-light text-white">15.0</span>
                <span class="text-xl text-gray-400">°C</span>
            </div>
            <div id="climate-status" class="mt-2 inline-block px-2 py-1 rounded text-[10px] font-bold uppercase bg-green-500/20 text-green-400 border border-green-500/30">
                Habitable
            </div>
        </div>

        <!-- CONTROLS -->
        <div class="p-6 space-y-8 flex-1">
            
            <!-- Control 1 -->
            <div class="group">
                <div class="flex justify-between mb-2">
                    <label class="text-xs font-bold text-orange-300 uppercase">Solar Irradiance (S)</label>
                    <span class="text-xs font-mono text-white"><span id="val-s">1361</span> W/m²</span>
                </div>
                <input type="range" id="slider-s" min="0" max="2500" value="1361">
                <p class="text-[10px] text-gray-500 mt-1">Energy received from the Sun per square meter.</p>
            </div>

            <!-- Control 2 -->
            <div class="group">
                <div class="flex justify-between mb-2">
                    <label class="text-xs font-bold text-blue-300 uppercase">Albedo ($\alpha$)</label>
                    <span class="text-xs font-mono text-white"><span id="val-a">0.30</span></span>
                </div>
                <input type="range" id="slider-a" min="0" max="1" step="0.01" value="0.30">
                <p class="text-[10px] text-gray-500 mt-1">Reflectivity. 0 = Black Body, 1 = Mirror.</p>
            </div>

            <!-- Control 3 -->
            <div class="group">
                <div class="flex justify-between mb-2">
                    <label class="text-xs font-bold text-green-300 uppercase">Greenhouse Effect ($G$)</label>
                    <span class="text-xs font-mono text-white">+<span id="val-g">33</span> K</span>
                </div>
                <input type="range" id="slider-g" min="0" max="100" value="33">
                <div class="flex justify-between text-[10px] text-gray-600 mt-1">
                    <span>None (Mars)</span>
                    <span>Earth</span>
                    <span>Venus++</span>
                </div>
                <p class="text-[10px] text-gray-500 mt-1">Trapped infrared radiation warming the surface.</p>
            </div>

            <!-- DATA BREAKDOWN -->
            <div class="pt-6 border-t border-white/10">
                <h3 class="text-xs font-bold text-gray-400 uppercase mb-4">Energy Budget</h3>
                
                <div class="stat-row">
                    <span>Incoming Solar</span>
                    <span class="stat-val text-orange-300"><span id="budget-in">340</span> W/m²</span>
                </div>
                <div class="stat-row">
                    <span>Reflected Out</span>
                    <span class="stat-val text-white"><span id="budget-reflected">102</span> W/m²</span>
                </div>
                <div class="stat-row">
                    <span>Absorbed (Net)</span>
                    <span class="stat-val text-blue-300"><span id="budget-absorbed">238</span> W/m²</span>
                </div>
                <div class="stat-row">
                    <span>Effective Temp (No G)</span>
                    <span class="stat-val text-gray-400"><span id="calc-teff">-18</span> °C</span>
                </div>
            </div>
        </div>
    </aside>

    <script>
        const SIGMA = 5.67e-8;
        const FREEZING_K = 273.15;

        const state = {
            S: 1361,
            a: 0.30,
            G: 33, // Greenhouse delta in Kelvin
            tempC: 15,
            tempK: 288
        };

        // DOM Elements
        const el = {
            sliderS: document.getElementById('slider-s'),
            sliderA: document.getElementById('slider-a'),
            sliderG: document.getElementById('slider-g'),
            valS: document.getElementById('val-s'),
            valA: document.getElementById('val-a'),
            valG: document.getElementById('val-g'),
            displayTempC: document.getElementById('display-temp-c'),
            status: document.getElementById('climate-status'),
            
            // Budget
            budgetIn: document.getElementById('budget-in'),
            budgetReflected: document.getElementById('budget-reflected'),
            budgetAbsorbed: document.getElementById('budget-absorbed'),
            calcTeff: document.getElementById('calc-teff'),

            // Visuals
            planetSurface: document.getElementById('planet-surface'),
            iceNorth: document.getElementById('ice-north'),
            iceSouth: document.getElementById('ice-south'),
            continents: document.querySelectorAll('.continent'),
            greenhouseLayer: document.getElementById('greenhouse-layer'),
            atmosphere: document.getElementById('atmosphere')
        };

        function updatePhysics() {
            state.S = parseFloat(el.sliderS.value);
            state.a = parseFloat(el.sliderA.value);
            state.G = parseFloat(el.sliderG.value);

            // 1. Calculate Fluxes (W/m2)
            // Incoming Solar Radiation averaged over sphere = S/4
            const incomingAvg = state.S / 4;
            const reflected = incomingAvg * state.a;
            const absorbed = incomingAvg * (1 - state.a);

            // 2. Calculate Effective Temp (Blackbody)
            let Teff_K = 0;
            if (absorbed > 0) {
                Teff_K = Math.pow(absorbed / SIGMA, 0.25);
            }

            // 3. Apply Greenhouse
            state.tempK = Teff_K + state.G;
            state.tempC = state.tempK - FREEZING_K;

            updateUI(incomingAvg, reflected, absorbed, Teff_K);
        }

        function updateUI(incoming, reflected, absorbed, Teff_K) {
            // Text Updates
            el.valS.textContent = state.S;
            el.valA.textContent = state.a.toFixed(2);
            el.valG.textContent = state.G;
            
            el.displayTempC.textContent = state.tempC.toFixed(1);
            
            el.budgetIn.textContent = incoming.toFixed(0);
            el.budgetReflected.textContent = reflected.toFixed(0);
            el.budgetAbsorbed.textContent = absorbed.toFixed(0);
            el.calcTeff.textContent = (Teff_K - FREEZING_K).toFixed(0);

            // --- Visual Updates ---

            // 1. Planet Colors & Status
            let statusText = "";
            let statusClass = "";
            let hue = 220; // Blue

            if (state.tempC < -50) {
                statusText = "Deep Freeze";
                statusClass = "bg-indigo-500/20 text-indigo-300 border-indigo-500/50";
                hue = 240; // Dark Blue
            } else if (state.tempC < 0) {
                statusText = "Ice Age";
                statusClass = "bg-cyan-500/20 text-cyan-300 border-cyan-500/50";
                hue = 200; // Icy Blue
            } else if (state.tempC < 30) {
                statusText = "Habitable";
                statusClass = "bg-green-500/20 text-green-400 border-green-500/50";
                hue = 120; // Green continents
            } else if (state.tempC < 70) {
                statusText = "Greenhouse";
                statusClass = "bg-orange-500/20 text-orange-300 border-orange-500/50";
                hue = 40; // Orange/Brown
            } else {
                statusText = "Inferno";
                statusClass = "bg-red-500/20 text-red-400 border-red-500/50";
                hue = 0; // Red
            }

            el.status.className = `mt-2 inline-block px-2 py-1 rounded text-[10px] font-bold uppercase border ${statusClass}`;
            el.status.textContent = statusText;

            // Update Continent Colors
            el.continents.forEach(c => {
                c.style.backgroundColor = `hsl(${hue}, 60%, 30%)`;
            });

            // 2. Ice Caps
            // Logic: Ice grows as temp drops below 0. Maxes out at -50.
            let icePercent = 0;
            if (state.tempC < 10) {
                // Map 10C -> -50C to 0% -> 50% height
                icePercent = Math.min(50, (10 - state.tempC) * 0.8);
            }
            el.iceNorth.style.height = `${icePercent}%`;
            el.iceSouth.style.height = `${icePercent}%`;

            // 3. Greenhouse Layer (Visual Opacity)
            el.greenhouseLayer.style.opacity = Math.min(1, state.G / 60);
            el.greenhouseLayer.style.borderColor = `rgba(255, 255, 255, ${Math.min(1, state.G/50)})`;
            
            // 4. Atmosphere color (redder if hotter/more GHG)
            const atmosHue = Math.max(0, 220 - (state.G * 3)); 
            el.atmosphere.style.background = `radial-gradient(circle, hsla(${atmosHue}, 80%, 50%, 0.2) 40%, rgba(0,0,0,0) 70%)`;
        }

        // --- Canvas Particle System ---
        const canvas = document.getElementById('sim-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resize() {
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = canvas.parentElement.offsetHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        class Photon {
            constructor() {
                this.reset();
            }

            reset() {
                this.x = -50;
                this.y = (canvas.height / 2) + (Math.random() - 0.5) * 180;
                this.speed = 3 + Math.random() * 2;
                this.size = 1 + Math.random();
                this.type = 'solar'; // solar, reflected, infrared
                this.life = 1;
            }

            update() {
                const earthX = canvas.width / 2;
                
                if (this.type === 'solar') {
                    this.x += this.speed;
                    
                    // Hit Planet Check
                    if (this.x > earthX - 100 && this.x < earthX + 100) {
                        // Simple approximation of hitting the sphere
                        if (Math.random() < state.a) {
                            // REFLECT!
                            this.type = 'reflected';
                            this.speed *= -1; // Bounce back
                        } else {
                            // ABSORBED -> Re-emit as Infrared
                            this.type = 'infrared';
                            // Infrared moves out in random direction, mostly right/up/down
                            this.vx = (Math.random() * 2) - 0.5;
                            this.vy = (Math.random() - 0.5) * 2;
                        }
                    }
                } else if (this.type === 'reflected') {
                    this.x += this.speed; // Speed is negative
                    this.life -= 0.01;
                } else if (this.type === 'infrared') {
                    this.x += this.speed * 0.5; 
                    // Greenhouse Effect: High G slows down/traps infrared visually
                    const trapFactor = state.G / 100;
                    if (Math.random() < trapFactor) {
                        this.x -= this.speed * 0.6; // Move back towards earth slightly
                    }
                    this.life -= 0.01;
                }

                // Respawn
                if (this.x > canvas.width || this.x < -100 || this.life <= 0) {
                    this.reset();
                }
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                
                if (this.type === 'solar') {
                    ctx.fillStyle = `rgba(253, 224, 71, ${this.life})`; // Yellow
                } else if (this.type === 'reflected') {
                    ctx.fillStyle = `rgba(255, 255, 255, ${this.life * 0.8})`; // White
                } else if (this.type === 'infrared') {
                    ctx.fillStyle = `rgba(239, 68, 68, ${this.life * 0.6})`; // Red
                }
                
                ctx.fill();
            }
        }

        // Initialize Particles
        for(let i=0; i<200; i++) particles.push(new Photon());

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Dynamic particle count based on slider S
            const activeCount = Math.floor((state.S / 2500) * particles.length);
            
            for(let i=0; i<activeCount; i++) {
                particles[i].update();
                particles[i].draw();
            }
            requestAnimationFrame(animate);
        }

        // Listeners
        el.sliderS.addEventListener('input', updatePhysics);
        el.sliderA.addEventListener('input', updatePhysics);
        el.sliderG.addEventListener('input', updatePhysics);

        // Init
        updatePhysics();
        animate();

    </script>
</body>
</html>
