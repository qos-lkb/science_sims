<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>原子結構互動模擬 (Atomic Structure Simulation)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        .element-btn:hover {
            transform: scale(1.05);
        }
        .element-btn.active {
            background-color: #3b82f6;
            color: white;
            border-color: #2563eb;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }
        canvas {
            background: radial-gradient(circle, #ffffff 0%, #f3f4f6 100%);
            border-radius: 1rem;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white shadow-sm py-3 px-6 flex justify-between items-center shrink-0 z-10">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold">Li</div>
            <h1 class="text-xl font-bold text-slate-700">原子結構與次原子模擬器</h1>
        </div>
        <div class="text-sm text-slate-500">化學科教學工具</div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col md:flex-row overflow-hidden">
        
        <!-- Left Panel: Controls & Stats -->
        <aside class="w-full md:w-1/3 lg:w-1/4 bg-white border-r border-slate-200 flex flex-col overflow-y-auto p-4 gap-4 shadow-lg z-10">
            
            <!-- Element Selection Grid -->
            <div class="bg-slate-50 p-3 rounded-xl border border-slate-200">
                <h2 class="text-sm font-semibold text-slate-500 mb-3 uppercase tracking-wide">選擇元素 (1-20)</h2>
                <div id="element-grid" class="grid grid-cols-5 gap-2">
                    <!-- Buttons generated by JS -->
                </div>
            </div>

            <!-- Stats Display -->
            <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 flex-1 flex flex-col justify-center">
                <h2 class="text-lg font-bold text-blue-800 mb-4 flex items-center gap-2">
                    <span class="w-2 h-6 bg-blue-600 rounded-full"></span>
                    次原子數據
                </h2>
                
                <div class="space-y-3">
                    <div class="flex justify-between items-center border-b border-blue-200 pb-2">
                        <span class="text-slate-600">原子序 (Z)</span>
                        <span id="stat-atomic-num" class="font-mono text-xl font-bold text-slate-800">1</span>
                    </div>
                    <div class="flex justify-between items-center border-b border-blue-200 pb-2">
                        <span class="text-slate-600">質量數 (A)</span>
                        <span id="stat-mass-num" class="font-mono text-xl font-bold text-slate-800">1</span>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-2 mt-4">
                        <div class="bg-white p-2 rounded-lg text-center shadow-sm border border-red-100">
                            <div class="text-xs text-red-500 font-bold mb-1">質子 (p⁺)</div>
                            <div id="stat-protons" class="text-2xl font-bold text-red-600">1</div>
                        </div>
                        <div class="bg-white p-2 rounded-lg text-center shadow-sm border border-slate-200">
                            <div class="text-xs text-slate-500 font-bold mb-1">中子 (n⁰)</div>
                            <div id="stat-neutrons" class="text-2xl font-bold text-slate-600">0</div>
                        </div>
                        <div class="bg-white p-2 rounded-lg text-center shadow-sm border border-yellow-200">
                            <div class="text-xs text-yellow-600 font-bold mb-1">電子 (e⁻)</div>
                            <div id="stat-electrons" class="text-2xl font-bold text-yellow-600">1</div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Right Panel: Visualization -->
        <section class="flex-1 bg-slate-100 p-4 flex flex-col relative">
            
            <!-- Canvas Container -->
            <div class="flex-1 relative bg-white rounded-2xl shadow-inner border border-slate-200 overflow-hidden flex items-center justify-center">
                <canvas id="atomCanvas" class="max-w-full max-h-full"></canvas>
                
                <!-- Legend -->
                <div class="absolute top-4 right-4 bg-white/90 backdrop-blur-sm p-3 rounded-lg shadow border border-slate-100 text-xs space-y-1">
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-red-500"></span> 質子 (Proton)</div>
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-slate-400"></span> 中子 (Neutron)</div>
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-yellow-400 border border-yellow-600"></span> 電子 (Electron)</div>
                </div>
            </div>

            <!-- Info Bar -->
            <div class="mt-4 bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex flex-col sm:flex-row justify-between items-center gap-4">
                <div class="text-center sm:text-left">
                    <div class="text-3xl font-bold text-slate-800">
                        <span id="display-symbol" class="text-blue-600 mr-2">H</span>
                        <span id="display-name-zh">氫</span>
                    </div>
                    <div id="display-name-en" class="text-slate-500 font-medium">Hydrogen</div>
                </div>
                
                <div class="flex flex-col items-center sm:items-end">
                    <div class="text-sm text-slate-500 uppercase tracking-wider mb-1">電子排佈 (Electron Config)</div>
                    <div id="display-config" class="text-2xl font-mono font-bold text-slate-800 bg-slate-100 px-4 py-1 rounded-lg">
                        1
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        // --- Data: First 20 Elements ---
        const elements = [
            { z: 1, symbol: 'H', nameEn: 'Hydrogen', nameZh: '氫', mass: 1 },
            { z: 2, symbol: 'He', nameEn: 'Helium', nameZh: '氦', mass: 4 },
            { z: 3, symbol: 'Li', nameEn: 'Lithium', nameZh: '鋰', mass: 7 },
            { z: 4, symbol: 'Be', nameEn: 'Beryllium', nameZh: '鈹', mass: 9 },
            { z: 5, symbol: 'B', nameEn: 'Boron', nameZh: '硼', mass: 11 },
            { z: 6, symbol: 'C', nameEn: 'Carbon', nameZh: '碳', mass: 12 },
            { z: 7, symbol: 'N', nameEn: 'Nitrogen', nameZh: '氮', mass: 14 },
            { z: 8, symbol: 'O', nameEn: 'Oxygen', nameZh: '氧', mass: 16 },
            { z: 9, symbol: 'F', nameEn: 'Fluorine', nameZh: '氟', mass: 19 },
            { z: 10, symbol: 'Ne', nameEn: 'Neon', nameZh: '氖', mass: 20 },
            { z: 11, symbol: 'Na', nameEn: 'Sodium', nameZh: '鈉', mass: 23 },
            { z: 12, symbol: 'Mg', nameEn: 'Magnesium', nameZh: '鎂', mass: 24 },
            { z: 13, symbol: 'Al', nameEn: 'Aluminium', nameZh: '鋁', mass: 27 },
            { z: 14, symbol: 'Si', nameEn: 'Silicon', nameZh: '矽', mass: 28 },
            { z: 15, symbol: 'P', nameEn: 'Phosphorus', nameZh: '磷', mass: 31 },
            { z: 16, symbol: 'S', nameEn: 'Sulfur', nameZh: '硫', mass: 32 },
            { z: 17, symbol: 'Cl', nameEn: 'Chlorine', nameZh: '氯', mass: 35 }, // Using 35 for simplicity (isotope)
            { z: 18, symbol: 'Ar', nameEn: 'Argon', nameZh: '氬', mass: 40 },
            { z: 19, symbol: 'K', nameEn: 'Potassium', nameZh: '鉀', mass: 39 },
            { z: 20, symbol: 'Ca', nameEn: 'Calcium', nameZh: '鈣', mass: 40 }
        ];

        // --- State ---
        let currentElementIndex = 0;
        const canvas = document.getElementById('atomCanvas');
        const ctx = canvas.getContext('2d');
        let animationFrameId;
        let electronAngleOffset = 0;

        // --- Initialization ---
        function init() {
            createGrid();
            resizeCanvas();
            selectElement(0); // Default to Hydrogen
            window.addEventListener('resize', () => {
                resizeCanvas();
                drawAtom();
            });
            animate();
        }

        // --- Helper: Electron Configuration Calculation ---
        function getElectronConfig(z) {
            const shells = [];
            let remaining = z;
            
            // Shell 1 (K): max 2
            let shell1 = Math.min(2, remaining);
            if(shell1 > 0) shells.push(shell1);
            remaining -= shell1;
            
            // Shell 2 (L): max 8
            if (remaining > 0) {
                let shell2 = Math.min(8, remaining);
                shells.push(shell2);
                remaining -= shell2;
            }
            
            // Shell 3 (M): max 8 (for first 20 elements)
            if (remaining > 0) {
                let shell3 = Math.min(8, remaining);
                shells.push(shell3);
                remaining -= shell3;
            }

            // Shell 4 (N): remaining
            if (remaining > 0) {
                shells.push(remaining);
            }
            
            return shells;
        }

        // --- UI Construction ---
        function createGrid() {
            const grid = document.getElementById('element-grid');
            elements.forEach((el, index) => {
                const btn = document.createElement('button');
                btn.className = `element-btn w-full aspect-square flex flex-col items-center justify-center rounded-lg border bg-white border-slate-200 text-slate-700 transition-all duration-200`;
                btn.innerHTML = `
                    <span class="text-[10px] leading-none opacity-60">${el.z}</span>
                    <span class="font-bold text-lg leading-tight">${el.symbol}</span>
                `;
                btn.onclick = () => selectElement(index);
                btn.id = `btn-${index}`;
                grid.appendChild(btn);
            });
        }

        function selectElement(index) {
            // UI Update
            document.querySelectorAll('.element-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${index}`).classList.add('active');

            currentElementIndex = index;
            updateStats();
            drawAtom();
        }

        function updateStats() {
            const el = elements[currentElementIndex];
            const protons = el.z;
            const mass = el.mass;
            const neutrons = mass - protons;
            const electrons = protons; // Neutral atom
            const config = getElectronConfig(protons);

            // Update DOM
            document.getElementById('stat-atomic-num').textContent = el.z;
            document.getElementById('stat-mass-num').textContent = mass;
            document.getElementById('stat-protons').textContent = protons;
            document.getElementById('stat-neutrons').textContent = neutrons;
            document.getElementById('stat-electrons').textContent = electrons;
            
            document.getElementById('display-symbol').textContent = el.symbol;
            document.getElementById('display-name-zh').textContent = el.nameZh;
            document.getElementById('display-name-en').textContent = el.nameEn;
            document.getElementById('display-config').textContent = config.join(', ');
        }

        // --- Visualization Logic ---
        function resizeCanvas() {
            const parent = canvas.parentElement;
            canvas.width = parent.clientWidth;
            canvas.height = parent.clientHeight;
        }

        function animate() {
            electronAngleOffset += 0.005; // Rotation speed
            drawAtom();
            animationFrameId = requestAnimationFrame(animate);
        }

        function drawAtom() {
            if (!ctx) return;
            const width = canvas.width;
            const height = canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            const el = elements[currentElementIndex];
            const protons = el.z;
            const neutrons = el.mass - protons;
            const config = getElectronConfig(protons);

            ctx.clearRect(0, 0, width, height);

            // 1. Draw Nucleus
            // To simulate a cluster, we use a pseudo-random generator seeded by index to keep positions stable
            const particleRadius = 6;
            const nucleusRadius = Math.max(15, Math.sqrt(el.mass) * 5); 

            // Draw neutrons first (bottom layer)
            for (let i = 0; i < neutrons; i++) {
                drawNucleusParticle(centerX, centerY, i, 'neutron', nucleusRadius, 137);
            }
            // Draw protons
            for (let i = 0; i < protons; i++) {
                drawNucleusParticle(centerX, centerY, i, 'proton', nucleusRadius, 42);
            }

            // 2. Draw Shells and Electrons
            const maxRadius = Math.min(width, height) / 2 - 20;
            const shellSpacing = (maxRadius - nucleusRadius) / 4; // Max 4 shells

            config.forEach((count, shellIndex) => {
                const shellRadius = nucleusRadius + 40 + (shellIndex * shellSpacing);
                
                // Draw Orbit Path
                ctx.beginPath();
                ctx.arc(centerX, centerY, shellRadius, 0, Math.PI * 2);
                ctx.strokeStyle = 'rgba(148, 163, 184, 0.4)'; // slate-400 with opacity
                ctx.lineWidth = 1.5;
                ctx.stroke();

                // Draw Electrons
                for (let i = 0; i < count; i++) {
                    // Distribute evenly on circle
                    const angle = (Math.PI * 2 * i) / count + electronAngleOffset * (shellIndex % 2 === 0 ? 1 : -1); 
                    const ex = centerX + Math.cos(angle) * shellRadius;
                    const ey = centerY + Math.sin(angle) * shellRadius;

                    // Glow
                    ctx.beginPath();
                    ctx.arc(ex, ey, 8, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(250, 204, 21, 0.3)'; // yellow glow
                    ctx.fill();

                    // Core
                    ctx.beginPath();
                    ctx.arc(ex, ey, 4, 0, Math.PI * 2);
                    ctx.fillStyle = '#eab308'; // yellow-500
                    ctx.fill();
                    ctx.strokeStyle = '#854d0e'; // yellow-800
                    ctx.lineWidth = 1;
                    ctx.stroke();
                }
            });
        }

        // Helper to draw protons/neutrons in a "clump" without collision physics (simplified visualization)
        function drawNucleusParticle(cx, cy, index, type, radiusBound, seedMult) {
            // Simple deterministic pseudo-random position based on index
            // This ensures the nucleus looks the same every frame for the same element
            const seed = index * seedMult + currentElementIndex * 100;
            const r = (Math.sin(seed) * 0.5 + 0.5) * radiusBound * 0.8; // Random radius within bound
            const theta = Math.cos(seed * 1.5) * Math.PI * 2;

            const x = cx + r * Math.cos(theta);
            const y = cy + r * Math.sin(theta);

            ctx.beginPath();
            ctx.arc(x, y, 6, 0, Math.PI * 2);
            
            if (type === 'proton') {
                ctx.fillStyle = '#ef4444'; // red-500
                ctx.strokeStyle = '#991b1b';
            } else {
                ctx.fillStyle = '#94a3b8'; // slate-400
                ctx.strokeStyle = '#475569';
            }
            
            ctx.lineWidth = 1;
            ctx.fill();
            ctx.stroke();
            
            // Highlight
            ctx.beginPath();
            ctx.arc(x - 2, y - 2, 2, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(255,255,255,0.3)';
            ctx.fill();
        }

        // Start
        window.onload = init;

    </script>
</body>
</html>