<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台北聖誕浪漫之旅 2025</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Leaflet CSS (For Map) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8; 
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; 
        }
        
        .fade-in {
            animation: fadeIn 0.4s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .active-nav-item {
            background-color: #ecfdf5; /* Emerald 50 */
            border-right: 4px solid #10b981; /* Emerald 500 */
            color: #047857; /* Emerald 700 */
        }

        /* Map styling */
        .map-container iframe {
            width: 100%;
            height: 100%;
            border-radius: 0.75rem;
        }

        /* Accordion transition */
        .category-content {
            transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        .category-content.open {
            max-height: 2000px; /* Arbitrary large height to accommodate more items */
            opacity: 1;
        }
        
        /* Leaflet Map Customization */
        #main-map {
            height: 100%;
            width: 100%;
            border-radius: 0.75rem;
            z-index: 1;
        }
    </style>
</head>
<body class="h-screen flex overflow-hidden text-slate-800">

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- Sidebar -->
    <aside class="w-72 bg-white shadow-xl z-20 flex flex-col h-full border-r border-slate-200 hidden md:flex">
        <div class="p-6 bg-gradient-to-r from-emerald-600 to-teal-600 text-white shadow-md flex-shrink-0 cursor-pointer" onclick="showWelcomeScreen()">
            <h1 class="text-xl font-bold tracking-wider flex items-center"><i class="fas fa-plane-departure mr-2"></i>台北之旅</h1>
            <p class="text-xs text-emerald-100 mt-1">聖誕假期 • 兩人世界</p>
        </div>
        
        <div class="p-4 border-b border-slate-100 bg-slate-50 flex-shrink-0">
            <div class="relative">
                <i class="fas fa-search absolute left-3 top-3 text-slate-400 text-sm"></i>
                <input type="text" id="search-input" placeholder="搜尋景點或餐廳..." class="w-full pl-9 pr-4 py-2 bg-white border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all">
            </div>
        </div>

        <nav class="flex-1 overflow-y-auto py-2" id="attraction-list">
            <!-- JavaScript will populate this list -->
        </nav>

        <div class="p-4 bg-slate-50 border-t border-slate-200 flex-shrink-0">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600">
                    <i class="fas fa-user-friends text-xs"></i>
                </div>
                <div>
                    <p class="text-sm font-bold text-slate-700">旅遊小幫手</p>
                    <p class="text-xs text-slate-500">12月下旬 • 平均 16°C</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Mobile Header (Visible only on small screens) -->
    <div class="md:hidden fixed top-0 left-0 right-0 h-14 bg-emerald-600 text-white z-30 flex items-center justify-between px-4 shadow-md">
        <span class="font-bold cursor-pointer" onclick="showWelcomeScreen()">台北聖誕之旅</span>
        <button id="mobile-menu-btn" class="text-white focus:outline-none">
            <i class="fas fa-bars"></i>
        </button>
    </div>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden">
        <div class="bg-white w-72 h-full flex flex-col shadow-xl transform transition-transform duration-300 -translate-x-full" id="mobile-menu-content">
             <div class="p-4 bg-emerald-600 text-white flex justify-between items-center flex-shrink-0">
                 <span class="font-bold">景點分類</span>
                 <button id="close-mobile-menu"><i class="fas fa-times"></i></button>
             </div>
             <nav class="flex-1 overflow-y-auto py-2" id="mobile-attraction-list">
                 <!-- Populated by JS -->
             </nav>
        </div>
    </div>


    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-full overflow-hidden relative bg-slate-50 mt-14 md:mt-0">
        <!-- Top Navigation / Header -->
        <header class="bg-white h-16 shadow-sm flex items-center justify-between px-6 md:px-8 border-b border-slate-200 z-10 flex-shrink-0">
            <h2 class="text-lg md:text-xl font-bold text-slate-700 flex items-center truncate">
                <span id="header-title">全區地圖總覽</span>
            </h2>
            <div class="flex items-center space-x-3 md:space-x-4 flex-shrink-0">
                <button onclick="showWelcomeScreen()" class="text-sm font-bold text-emerald-600 hover:text-emerald-800 flex items-center bg-emerald-50 px-3 py-1 rounded-full transition">
                    <i class="fas fa-map mr-1"></i> 回地圖
                </button>
                <div class="h-8 w-8 rounded-full bg-emerald-600 text-white flex items-center justify-center font-bold text-sm shadow-md cursor-help flex-shrink-0" title="Taiwan">
                    TW
                </div>
            </div>
        </header>

        <!-- Content Area -->
        <div id="content-area" class="flex-1 overflow-y-auto relative scroll-smooth bg-slate-100">
            <!-- Initial State (Map View) -->
            <div id="welcome-screen" class="flex flex-col h-full w-full relative">
                <div class="absolute top-4 left-1/2 transform -translate-x-1/2 z-10 bg-white/90 backdrop-blur px-6 py-2 rounded-full shadow-lg border border-slate-200 pointer-events-none md:pointer-events-auto text-center w-11/12 md:w-auto">
                    <h3 class="font-bold text-slate-700 text-sm md:text-base"><i class="fas fa-map-marked-alt text-emerald-500 mr-2"></i>台北精選景點地圖</h3>
                    <p class="text-xs text-slate-500 hidden md:block">包含歷史古蹟與必吃美食名店</p>
                </div>
                <!-- Leaflet Map Container -->
                <div id="main-map" class="w-full h-full"></div>
            </div>

            <!-- Detail View (Hidden by default) -->
            <div id="detail-view" class="hidden fade-in max-w-6xl mx-auto pb-12 p-4 md:p-8">
                <!-- Hero Section -->
                <div class="relative h-56 md:h-80 rounded-2xl overflow-hidden shadow-lg mb-6 group bg-slate-200">
                    <img id="detail-image" src="" alt="Attraction" class="w-full h-full object-cover transform group-hover:scale-105 transition duration-700 opacity-0" onload="this.classList.remove('opacity-0')">
                    <div class="absolute inset-0 bg-gradient-to-t from-slate-900/80 via-transparent to-transparent"></div>
                    <div class="absolute bottom-0 left-0 p-6 md:p-8 w-full">
                        <div class="flex flex-wrap items-center gap-2 mb-2">
                            <span id="detail-tag" class="px-3 py-1 bg-emerald-500 text-white text-xs font-bold rounded-full shadow-sm">景點</span>
                            <span class="px-3 py-1 bg-white/20 text-white text-xs font-bold rounded-full backdrop-blur-sm"><i class="fas fa-star text-yellow-400 mr-1"></i>4.8</span>
                        </div>
                        <h1 id="detail-name" class="text-3xl md:text-4xl font-bold text-white mb-2 shadow-sm">景點名稱</h1>
                        <p id="detail-desc" class="text-slate-200 text-sm md:text-base max-w-3xl line-clamp-2 md:line-clamp-none">景點描述...</p>
                    </div>
                </div>

                <!-- Dashboard Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Info Card -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex flex-col hover:shadow-md transition duration-300">
                        <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4 border-b border-slate-100 pb-2">基本資訊</h4>
                        <ul class="space-y-4 text-sm text-slate-600 flex-1">
                            <li class="flex items-start">
                                <div class="w-8 flex justify-center"><i class="fas fa-clock mt-1 text-emerald-500"></i></div>
                                <div>
                                    <span class="font-bold block text-slate-800 text-xs uppercase mb-0.5">開放時間</span>
                                    <span id="detail-hours">09:00 - 22:00</span>
                                </div>
                            </li>
                            <li class="flex items-start">
                                <div class="w-8 flex justify-center"><i class="fas fa-wallet mt-1 text-emerald-500"></i></div>
                                <div>
                                    <span class="font-bold block text-slate-800 text-xs uppercase mb-0.5">費用/預算</span>
                                    <span id="detail-price">NT$ 600</span>
                                </div>
                            </li>
                            <li class="flex items-start">
                                <div class="w-8 flex justify-center"><i class="fas fa-map-marker-alt mt-1 text-emerald-500"></i></div>
                                <div>
                                    <span class="font-bold block text-slate-800 text-xs uppercase mb-0.5">地址</span>
                                    <span id="detail-address" class="text-slate-500">台北市...</span>
                                </div>
                            </li>
                        </ul>
                    </div>

                    <!-- Transport Card -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex flex-col hover:shadow-md transition duration-300">
                        <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4 border-b border-slate-100 pb-2">交通方式</h4>
                        <div class="flex-1 flex flex-col justify-center space-y-3">
                            <div class="flex items-center p-3 bg-blue-50/50 border border-blue-100 rounded-lg text-blue-800">
                                <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mr-3 flex-shrink-0">
                                    <i class="fas fa-subway text-blue-600"></i>
                                </div>
                                <div>
                                    <span class="text-[10px] font-bold uppercase block text-blue-400">捷運 MRT</span>
                                    <span id="detail-mrt" class="font-bold text-sm">台北101/世貿站</span>
                                </div>
                            </div>
                            <div class="flex items-center p-3 bg-orange-50/50 border border-orange-100 rounded-lg text-orange-800">
                                <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center mr-3 flex-shrink-0">
                                    <i class="fas fa-bus text-orange-600"></i>
                                </div>
                                <div>
                                    <span class="text-[10px] font-bold uppercase block text-orange-400">公車 / 其他</span>
                                    <span id="detail-bus" class="text-sm">信義幹線</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Map Widget (Detail specific) -->
                    <div class="bg-white p-2 rounded-xl shadow-sm border border-slate-100 h-64 lg:h-auto overflow-hidden relative group">
                        <div id="map-frame" class="w-full h-full bg-slate-100 rounded-lg overflow-hidden relative">
                             <iframe id="google-map-iframe" class="filter grayscale hover:grayscale-0 transition duration-500" frameborder="0" style="border:0" allowfullscreen loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                        </div>
                        <a id="map-link" href="#" target="_blank" class="absolute bottom-4 right-4 bg-white text-slate-800 px-4 py-2 rounded-full shadow-lg text-xs font-bold hover:bg-emerald-600 hover:text-white transition flex items-center group-hover:translate-y-0 translate-y-2 opacity-90 hover:opacity-100">
                            <i class="fas fa-location-arrow mr-2"></i> Google Map
                        </a>
                    </div>
                </div>

                <!-- Info & Tips Section -->
                <div class="bg-slate-800 rounded-2xl p-6 md:p-8 text-white shadow-xl relative overflow-hidden">
                    <!-- Decor -->
                    <div class="absolute top-0 right-0 -mt-10 -mr-10 w-64 h-64 bg-emerald-500 rounded-full blur-[80px] opacity-20 pointer-events-none"></div>
                    <div class="absolute bottom-0 left-0 -mb-10 -ml-10 w-64 h-64 bg-blue-500 rounded-full blur-[80px] opacity-20 pointer-events-none"></div>
                    
                    <div class="relative z-10">
                        <div class="flex items-center mb-6">
                            <div class="w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center text-emerald-400 mr-3">
                                <i class="fas fa-snowflake"></i>
                            </div>
                            <h3 class="text-xl font-bold">12月旅遊資訊及小貼士</h3>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Feature Notes -->
                            <div class="space-y-4">
                                <div>
                                    <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">景點特色筆記</h4>
                                    <p id="detail-tips-content" class="text-slate-300 text-sm leading-relaxed border-l-2 border-emerald-500/50 pl-4">
                                        這裡將顯示該景點的詳細特色介紹...
                                    </p>
                                </div>
                                <div class="flex flex-wrap gap-2 pt-2">
                                    <span class="px-2 py-1 bg-white/10 rounded text-xs text-emerald-200">#浪漫</span>
                                    <span class="px-2 py-1 bg-white/10 rounded text-xs text-emerald-200">#聖誕</span>
                                    <span class="px-2 py-1 bg-white/10 rounded text-xs text-emerald-200">#拍照</span>
                                </div>
                            </div>
                            
                            <!-- Weather & Checklist -->
                            <div class="bg-white/5 rounded-xl p-5 border border-white/10">
                                <h4 class="text-xs font-bold text-emerald-400 uppercase tracking-wider mb-4">行前檢查 Check List</h4>
                                <ul class="space-y-3 text-sm text-slate-300">
                                    <li class="flex items-start">
                                        <i class="fas fa-check-circle mt-1 mr-3 text-emerald-500 text-xs"></i>
                                        <span id="detail-weather-tip">天氣：12月台北濕冷，建議洋蔥式穿搭。</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-check-circle mt-1 mr-3 text-emerald-500 text-xs"></i>
                                        <span id="detail-specific-tip">建議平日前往以避開聖誕人潮。</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-check-circle mt-1 mr-3 text-emerald-500 text-xs"></i>
                                        <span>記得攜帶悠遊卡 (EasyCard) 方便搭車。</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script>
        // 景點資料庫 (Data) - Added Coordinates and more items
        const attractions = [
            // --- 地標 Landmark ---
            {
                id: 'taipei-101',
                name: '台北 101 觀景台',
                tag: '地標',
                desc: '台北的天際線地標，登上89樓觀景台可俯瞰整個台北盆地的夜景。聖誕期間周邊信義區有璀璨的燈飾佈置，非常浪漫。',
                hours: '10:00 - 21:00',
                price: 'NT$ 600',
                address: '台北市信義區信義路五段7號',
                mrt: 'R03 台北101/世貿站 4號出口',
                bus: '信義幹線、藍5',
                tips: '建議下午16:30左右上樓，可以一次看到日落、魔幻時刻與百萬夜景。信義區香堤大道會有巨大的聖誕樹。',
                weather: '高空風大，若要前往91樓戶外區，請務必多加件防風外套。',
                mapQuery: 'Taipei 101 Observatory',
                imagePrompt: 'Taipei 101 fireworks night',
                lat: 25.0339, lng: 121.5644
            },
            {
                id: 'cks',
                name: '中正紀念堂',
                tag: '地標',
                desc: '藍白相間的宏偉建築，象徵自由廣場。整點的儀隊交接儀式莊嚴肅穆，是遊客必看亮點。',
                hours: '09:00 - 18:00',
                price: '免費',
                address: '台北市中正區中山南路21號',
                mrt: 'R08/G10 中正紀念堂站 5號出口',
                bus: '信義幹線等多線公車',
                tips: '晚上點燈後的紀念堂別有一番風味，很適合情侶散步。',
                weather: '廣場極為空曠，冬季風勢強勁，務必戴帽子。',
                mapQuery: 'Chiang Kai-shek Memorial Hall',
                imagePrompt: 'Chiang Kai-shek Memorial Hall Taipei',
                lat: 25.0354, lng: 121.5197
            },
            {
                id: 'miramar',
                name: '美麗華摩天輪',
                tag: '地標',
                desc: '台北北邊的地標，巨大的綠色摩天輪在夜晚非常顯眼。搭乘透明車廂可欣賞不一樣的台北夜景。',
                hours: '11:00 - 23:00',
                price: '平日$150 / 假日$200',
                address: '台北市中山區敬業三路20號',
                mrt: 'BR15 劍南路站 3號出口',
                bus: '內湖幹線、21、28',
                tips: '摩天輪下方就是購物中心與電影院，是典型的約會一條龍行程。聖誕節會有現場音樂表演。',
                weather: '戶外設施，若風太大可能會暫停營運。',
                mapQuery: 'Miramar Ferris Wheel',
                imagePrompt: 'Miramar Ferris Wheel Taipei night green light',
                lat: 25.0836, lng: 121.5574
            },

            // --- 歷史 History ---
            {
                id: 'npm',
                name: '國立故宮博物院',
                tag: '歷史',
                desc: '擁有近70萬件中華文物瑰寶，翠玉白菜與肉形石是必看展品。',
                hours: '09:00 - 17:00 (週一休)',
                price: 'NT$ 350',
                address: '台北市士林區至善路二段221號',
                mrt: 'R16 士林站 (轉乘公車)',
                bus: '紅30、304、255',
                tips: '避開團體遊客的最佳時間是中午。看完展覽可以到旁邊的「至善園」散步。',
                weather: '室內行程，非常適合雨備。',
                mapQuery: 'National Palace Museum Taipei',
                imagePrompt: 'National Palace Museum Taipei exterior',
                lat: 25.1020, lng: 121.5486
            },
            {
                id: 'dihua',
                name: '大稻埕 / 迪化街',
                tag: '歷史',
                desc: '保留完整的紅磚洋樓建築，是南北貨、中藥材、布料的集散地。霞海城隍廟月老非常靈驗。',
                hours: '10:00 - 19:00',
                price: '免費',
                address: '台北市大同區迪化街一段',
                mrt: 'G13 北門站 3號出口',
                bus: '南京西路口',
                tips: '大稻埕碼頭市集(PIER5)傍晚很美，可以在貨櫃屋頂喝飲料看夕陽。',
                weather: '適合散步的街區，晴天最佳。',
                mapQuery: 'Dihua Street',
                imagePrompt: 'Dihua Street Taipei old buildings red brick',
                lat: 25.0556, lng: 121.5101
            },
            {
                id: 'longshan',
                name: '艋舺龍山寺',
                tag: '歷史',
                desc: '台北最古老且香火最鼎盛的寺廟之一，建築精美。據說月老靈驗，可祈求感情順利。',
                hours: '06:00 - 22:00',
                price: '免費',
                address: '台北市萬華區廣州街211號',
                mrt: 'BL10 龍山寺站 1號出口',
                bus: '龍山寺站',
                tips: '參拜後可以去旁邊的剝皮寮歷史街區走走，感受清代街道氛圍。',
                weather: '香火鼎盛，人多溫暖。',
                mapQuery: 'Longshan Temple',
                imagePrompt: 'Longshan Temple Taipei incense smoke',
                lat: 25.0368, lng: 121.4999
            },
            {
                id: 'linantai',
                name: '林安泰古厝',
                tag: '歷史',
                desc: '台北市保存最完整的閩南式古宅建築，庭園造景優美，古色古香。',
                hours: '09:00 - 17:00 (週一休)',
                price: '免費',
                address: '台北市中山區濱江街5號',
                mrt: 'R14 圓山站 (轉公車/步行)',
                bus: '市民小巴9',
                tips: '非常適合穿著旗袍或漢服來拍照。古厝常有舉辦傳統文化體驗活動。',
                weather: '戶外庭園多，建議晴天前往。',
                mapQuery: 'Lin An Tai Historical House',
                imagePrompt: 'Lin An Tai Historical House garden',
                lat: 25.0716, lng: 121.5306
            },
            {
                id: 'bopiliao',
                name: '剝皮寮歷史街區',
                tag: '歷史',
                desc: '清代街道風貌保存完整的街區，紅磚牆與拱型騎樓充滿復古氛圍。',
                hours: '09:00 - 21:00 (週一休)',
                price: '免費',
                address: '台北市萬華區康定路173巷',
                mrt: 'BL10 龍山寺站',
                bus: '龍山寺站',
                tips: '電影《艋舺》的拍攝場景。就在龍山寺旁，建議安排在一起參觀。',
                weather: '有騎樓遮蔽，雨天也不影響。',
                mapQuery: 'Bopiliao Historical Block',
                imagePrompt: 'Bopiliao Historical Block Taipei red brick',
                lat: 25.0365, lng: 121.5023
            },
            {
                id: 'confucius',
                name: '台北孔廟',
                tag: '歷史',
                desc: '建築風格樸素莊嚴，沒有一般廟宇的華麗裝飾，展現儒家文化的氣質。',
                hours: '08:30 - 21:00 (週一休)',
                price: '免費',
                address: '台北市大同區大龍街275號',
                mrt: 'R14 圓山站 2號出口',
                bus: '庫倫街口',
                tips: '雖然是古蹟，但常有很可愛的文創商品和祈福卡。旁邊的大龍峒保安宮也非常華麗值得一看。',
                weather: '戶外為主。',
                mapQuery: 'Taipei Confucius Temple',
                imagePrompt: 'Taipei Confucius Temple architecture',
                lat: 25.0736, lng: 121.5164
            },

            // --- 河岸 Riverside ---
            {
                id: 'tamsui',
                name: '淡水老街 & 漁人碼頭',
                tag: '河岸',
                desc: '享受河岸風光、夕陽與古蹟。漁人碼頭的情人橋是情侶必訪之地。',
                hours: '全天開放',
                price: '免費',
                address: '新北市淡水區中正路',
                mrt: 'R28 淡水站',
                bus: '轉乘紅26至漁人碼頭',
                tips: '一定要試試「阿給」。12月的淡水河邊海風非常強勁，帽子要戴好。',
                weather: '全台最冷的地方之一，務必穿著防風外套。',
                mapQuery: 'Tamsui Fisherman\'s Wharf',
                imagePrompt: 'Tamsui Fisherman\'s Wharf sunset bridge',
                lat: 25.1764, lng: 121.4423
            },
            {
                id: 'pier5',
                name: '大稻埕碼頭貨櫃市集',
                tag: '河岸',
                desc: '位於淡水河畔的貨櫃市集，有多國美食與酒吧，是欣賞河景夕陽的絕佳地點。',
                hours: '16:00 - 00:00',
                price: '依消費而定',
                address: '台北市大同區民生西路底',
                mrt: 'G13 北門站 或 R11 雙連站',
                bus: '民生西路口',
                tips: '建議傍晚前往，從夕陽看到夜景。週末常有Live Band演出。',
                weather: '河邊風大，晚上較涼。',
                mapQuery: 'Dadaocheng Wharf Container Market',
                imagePrompt: 'Dadaocheng Wharf Container Market night',
                lat: 25.0568, lng: 121.5074
            },

            // --- 美食 Food ---
            {
                id: 'dintaifung',
                name: '鼎泰豐 (101店)',
                tag: '美食',
                desc: '台灣之光，享譽國際的小籠包名店。服務細緻，餐點水準極高。',
                hours: '11:00 - 21:00',
                price: '約 NT$ 500-800/人',
                address: '台北市信義區市府路45號B1 (台北101)',
                mrt: 'R03 台北101/世貿站',
                bus: '台北101',
                tips: '必點：小籠包、排骨蛋炒飯、酸辣湯。建議下載App先抽號碼牌，通常要等候30-60分鐘，可先去逛街。',
                weather: '位於百貨公司內，舒適方便。',
                mapQuery: 'Din Tai Fung Taipei 101',
                imagePrompt: 'Din Tai Fung xiaolongbao dumplings',
                lat: 25.0336, lng: 121.5646
            },
            {
                id: 'fuhang',
                name: '阜杭豆漿',
                tag: '美食',
                desc: '米其林必比登推薦的傳統早餐，厚餅夾蛋與鹹豆漿是人氣必點。',
                hours: '05:30 - 12:30 (週一休)',
                price: '約 NT$ 100/人',
                address: '台北市中正區忠孝東路一段108號2樓',
                mrt: 'BL13 善導寺站 5號出口',
                bus: '捷運善導寺站',
                tips: '要有排隊的心理準備（通常30分鐘起跳）。厚餅是在烤爐裡現烤的，香氣十足。',
                weather: '排隊隊伍在樓梯間和騎樓，不會淋雨。',
                mapQuery: 'Fu Hang Soy Milk',
                imagePrompt: 'Fu Hang Soy Milk breakfast taiwan',
                lat: 25.0443, lng: 121.5247
            },
            {
                id: 'addiction',
                name: '上引水產',
                tag: '美食',
                desc: '結合魚市場與餐廳的複合式空間，立吞壽司（站著吃）非常受歡迎，海鮮極度新鮮。',
                hours: '07:00 - 00:00',
                price: '約 NT$ 600-1500/人',
                address: '台北市中山區民族東路410巷2弄18號',
                mrt: 'O09 行天宮站 (需步行15分或計程車)',
                bus: '第二果菜市場',
                tips: '如果不習慣站著吃，也有戶外燒烤區（備有暖爐）或火鍋區。只收現金，記得帶錢！',
                weather: '室內與半戶外空間。',
                mapQuery: 'Addiction Aquatic Development',
                imagePrompt: 'Addiction Aquatic Development sushi',
                lat: 25.0668, lng: 121.5369
            },
            {
                id: 'yongkang',
                name: '永康牛肉麵',
                tag: '美食',
                desc: '台北老字號川味牛肉麵，湯頭濃郁微辣，牛肉大塊軟嫩。',
                hours: '11:00 - 20:30',
                price: '約 NT$ 300/人',
                address: '台北市大安區金山南路二段31巷17號',
                mrt: 'R07/O06 東門站',
                bus: '信義金山路口',
                tips: '吃完可以在永康街逛逛，附近有很多芒果冰店（如思慕昔）和文創小店。',
                weather: '室內用餐。',
                mapQuery: 'Yong Kang Beef Noodles',
                imagePrompt: 'Taiwanese beef noodle soup',
                lat: 25.0329, lng: 121.5282
            },
            {
                id: 'shilin',
                name: '士林夜市',
                tag: '美食',
                desc: '台北最具規模的夜市，美食、購物、遊戲應有盡有。大雞排是經典。',
                hours: '16:00 - 00:00',
                price: '依消費而定',
                address: '台北市士林區基河路101號',
                mrt: 'R15 劍潭站 1號出口',
                bus: '多線公車至劍潭站',
                tips: '建議往廟口方向走，巷弄小吃更道地。',
                weather: '人潮擁擠會比較溫暖。',
                mapQuery: 'Shilin Night Market',
                imagePrompt: 'Shilin Night Market food street',
                lat: 25.0877, lng: 121.5242
            },
            {
                id: 'raohe',
                name: '饒河街觀光夜市',
                tag: '美食',
                desc: '街道筆直好逛，入口處的慈祐宮華麗壯觀。必吃胡椒餅。',
                hours: '17:00 - 23:00',
                price: '依消費而定',
                address: '台北市松山區饒河街',
                mrt: 'G19 松山站 5號出口',
                bus: '松山車站',
                tips: '胡椒餅通常大排長龍。夜市後方就是彩虹橋，適合散步。',
                weather: '河邊風大。',
                mapQuery: 'Raohe Street Night Market',
                imagePrompt: 'Raohe Night Market gate',
                lat: 25.0509, lng: 121.5775
            },
            {
                id: 'ningxia',
                name: '寧夏夜市',
                tag: '美食',
                desc: '以傳統台灣小吃為主，被譽為「台北人的胃」。芋頭酥、蚵仔煎是排隊名店。',
                hours: '17:00 - 01:00',
                price: '依消費而定',
                address: '台北市大同區寧夏路',
                mrt: 'R11 雙連站 1號出口',
                bus: '民生西路口',
                tips: '範圍不大但攤位集中，建議空著肚子來。千歲宴可以一次吃到多種小吃（需預訂）。',
                weather: '露天夜市，雨天較不便。',
                mapQuery: 'Ningxia Night Market',
                imagePrompt: 'Ningxia Night Market food stalls',
                lat: 25.0566, lng: 121.5153
            },

            // --- 文藝 Art & Culture ---
            {
                id: 'huashan',
                name: '華山 1914 文創園區',
                tag: '文藝',
                desc: '舊酒廠改建，充滿工業風與綠意。文青情侶必去。',
                hours: '24小時',
                price: '園區免費',
                address: '台北市中正區八德路一段1號',
                mrt: 'BL14 忠孝新生站 1號出口',
                bus: '華山文創園區',
                tips: '有很多風格咖啡廳，非常適合拍照。週末草地上常有表演。',
                weather: '戶外空間多，若下雨可躲進電影院。',
                mapQuery: 'Huashan 1914 Creative Park',
                imagePrompt: 'Huashan 1914 Creative Park',
                lat: 25.0441, lng: 121.5294
            },
            {
                id: 'songshan',
                name: '松山文創園區',
                tag: '文藝',
                desc: '前身為菸草工廠。園區內的誠品行旅和誠品生活非常好逛。',
                hours: '09:00 - 18:00',
                price: '園區免費',
                address: '台北市信義區光復南路133號',
                mrt: 'BL17 國父紀念館站 5號出口',
                bus: '聯合報站',
                tips: '逛完可以去旁邊的誠品電影院看場電影。',
                weather: '室內展覽豐富，雨天備案首選。',
                mapQuery: 'Songshan Cultural and Creative Park',
                imagePrompt: 'Songshan Cultural and Creative Park lake',
                lat: 25.0437, lng: 121.5606
            },
            {
                id: 'tfam',
                name: '臺北市立美術館',
                tag: '文藝',
                desc: '台灣第一座現代美術館，建築本身即是藝術品。展覽多樣且前衛，是拍照打卡熱點。',
                hours: '09:30 - 17:30 (週六至20:30, 週一休)',
                price: 'NT$ 30',
                address: '台北市中山區中山北路三段181號',
                mrt: 'R14 圓山站 1號出口',
                bus: '臺北市立美術館',
                tips: '旁邊的「台北故事館」歐式建築也很美。圓山園區常有市集。',
                weather: '全室內空調，舒適。',
                mapQuery: 'Taipei Fine Arts Museum',
                imagePrompt: 'Taipei Fine Arts Museum white architecture',
                lat: 25.0725, lng: 121.5247
            },
             {
                id: 'treasure',
                name: '寶藏巖國際藝術村',
                tag: '文藝',
                desc: '依山而建的聚落，充滿歷史感與現代藝術的衝突美。巷弄曲折，每個轉角都有驚喜。',
                hours: '11:00 - 22:00 (週一休)',
                price: '免費',
                address: '台北市中正區汀州路三段230巷14弄2號',
                mrt: 'G07 公館站 1號出口',
                bus: '捷運公館站',
                tips: '這裡有很多駐村藝術家的工作室。適合喜歡深度探索的情侶。',
                weather: '戶外階梯多，雨天濕滑需小心。',
                mapQuery: 'Treasure Hill Artist Village',
                imagePrompt: 'Treasure Hill Artist Village taipei',
                lat: 25.0109, lng: 121.5317
            },

            // --- 自然 Nature ---
            {
                id: 'xiangshan',
                name: '象山自然步道',
                tag: '自然',
                desc: '拍攝台北101全景的最佳地點。',
                hours: '24小時',
                price: '免費',
                address: '台北市信義區信義路五段150巷',
                mrt: 'R02 象山站 2號出口',
                bus: '步行約10分鐘至登山口',
                tips: '階梯陡峭，請穿舒適鞋子。跨年煙火熱點。',
                weather: '雨天濕滑不建議前往。',
                mapQuery: 'Xiangshan Hiking Trail',
                imagePrompt: 'Taipei 101 view from Xiangshan',
                lat: 25.0272, lng: 121.5707
            },
            {
                id: 'maokong',
                name: '貓空纜車 & 茶園',
                tag: '自然',
                desc: '搭乘水晶車廂上山，山上產茶，是品茗賞夜景的好去處。',
                hours: '09:00 - 21:00 (週一休)',
                price: '單程 NT$ 120',
                address: '台北市文山區',
                mrt: 'BR01 動物園站 (轉纜車)',
                bus: '貓空遊園公車',
                tips: '晚餐選一家景觀茶餐廳，邊喝茶邊看夜景。',
                weather: '山上氣溫低，務必穿暖。',
                mapQuery: 'Maokong Gondola',
                imagePrompt: 'Maokong tea plantation view',
                lat: 24.9688, lng: 121.5872
            },
            {
                id: 'yangming',
                name: '陽明山花鐘 & 小油坑',
                tag: '自然',
                desc: '台北的後花園。小油坑有壯觀的硫磺噴氣孔，擎天崗有大草原與水牛。',
                hours: '24小時',
                price: '免費',
                address: '台北市北投區竹子湖路1-20號',
                mrt: 'R15 劍潭站 (轉公車)',
                bus: '紅5、260至陽明山總站',
                tips: '山上氣候變化大。若時間夠可去「草山夜未眠」看夜景吃晚餐。',
                weather: '山上風大且易起霧下雨，雨具必備。',
                mapQuery: 'Yangmingshan National Park',
                imagePrompt: 'Yangmingshan National Park grass field',
                lat: 25.1558, lng: 121.5458
            },

            // --- 購物 Shopping ---
            {
                id: 'ximen',
                name: '西門町商圈',
                tag: '購物',
                desc: '台北的潮流中心。紅樓、塗鴉街、電影街充滿活力。',
                hours: '11:00 - 23:00',
                price: '依消費而定',
                address: '台北市萬華區中華路一段',
                mrt: 'BL11/G12 西門站 6號出口',
                bus: '中華路北站',
                tips: '想體驗台灣早餐文化，可以試試附近的「永和豆漿」。',
                weather: '騎樓多，逛街方便。',
                mapQuery: 'Ximending',
                imagePrompt: 'Ximending Taipei neon street',
                lat: 25.0422, lng: 121.5080
            },
            
            // --- 溫泉 Hot Spring ---
            {
                id: 'beitou',
                name: '北投溫泉博物館',
                tag: '溫泉',
                desc: '充滿日式風情的溫泉鄉。博物館紅磚建築極美。地熱谷煙霧繚繞。',
                hours: '09:00 - 17:00 (週一休)',
                price: '免費 / 泡湯另計',
                address: '台北市北投區中山路2號',
                mrt: 'R22A 新北投站',
                bus: '步行即可',
                tips: '12月是泡湯旺季，建議預約湯屋。',
                weather: '冬天最溫暖的行程。',
                mapQuery: 'Beitou Hot Spring Museum',
                imagePrompt: 'Beitou Hot Spring Museum exterior',
                lat: 25.1367, lng: 121.5063
            },

             // --- 親子/情侶 Couple ---
            {
                id: 'zoo',
                name: '台北市立動物園',
                tag: '親子',
                desc: '亞洲最大的動物園之一，大貓熊館、企鵝館、穿山甲館是人氣展區。',
                hours: '09:00 - 17:00',
                price: 'NT$ 100',
                address: '台北市文山區新光路二段30號',
                mrt: 'BR01 動物園站 1號出口',
                bus: '捷運動物園站',
                tips: '建議搭乘遊客列車移動。',
                weather: '大部分為戶外，需準備雨具。',
                mapQuery: 'Taipei Zoo',
                imagePrompt: 'Taipei Zoo entrance',
                lat: 24.9984, lng: 121.5810
            }
        ];

        // DOM Elements
        const attractionList = document.getElementById('attraction-list');
        const mobileAttractionList = document.getElementById('mobile-attraction-list');
        const welcomeScreen = document.getElementById('welcome-screen');
        const detailView = document.getElementById('detail-view');
        const headerTitle = document.getElementById('header-title');
        const searchInput = document.getElementById('search-input');
        
        // Detail Elements
        const elName = document.getElementById('detail-name');
        const elDesc = document.getElementById('detail-desc');
        const elImage = document.getElementById('detail-image');
        const elHours = document.getElementById('detail-hours');
        const elPrice = document.getElementById('detail-price');
        const elAddress = document.getElementById('detail-address');
        const elMrt = document.getElementById('detail-mrt');
        const elBus = document.getElementById('detail-bus');
        const elTips = document.getElementById('detail-tips-content');
        const elWeatherTip = document.getElementById('detail-weather-tip');
        const elTag = document.getElementById('detail-tag');
        const elMapLink = document.getElementById('map-link');
        const elMapIframe = document.getElementById('google-map-iframe');

        // Map Variables
        let map;
        let markers = [];

        // --- Render List with Categories ---
        function renderList(filterText = '') {
            const renderTarget = (container) => {
                container.innerHTML = '';
                
                // 1. Filter items first
                const filtered = attractions.filter(a => a.name.includes(filterText) || a.tag.includes(filterText));
                
                // 2. Group by Tag
                const groups = filtered.reduce((acc, item) => {
                    if (!acc[item.tag]) acc[item.tag] = [];
                    acc[item.tag].push(item);
                    return acc;
                }, {});

                // 3. Define Category Order & Icons
                const categoryConfig = {
                    '地標': { icon: 'fa-landmark', color: 'text-indigo-500' },
                    '歷史': { icon: 'fa-history', color: 'text-amber-600' },
                    '河岸': { icon: 'fa-water', color: 'text-blue-500' },
                    '美食': { icon: 'fa-utensils', color: 'text-orange-500' },
                    '文藝': { icon: 'fa-palette', color: 'text-purple-500' },
                    '自然': { icon: 'fa-tree', color: 'text-emerald-500' },
                    '購物': { icon: 'fa-shopping-bag', color: 'text-pink-500' },
                    '溫泉': { icon: 'fa-hot-tub', color: 'text-teal-500' },
                    '親子': { icon: 'fa-child', color: 'text-yellow-500' }
                };

                // 4. Create UI
                Object.keys(groups).forEach(tag => {
                    const groupItems = groups[tag];
                    if (groupItems.length === 0) return;

                    const config = categoryConfig[tag] || { icon: 'fa-map-pin', color: 'text-gray-500' };

                    // Category Header
                    const header = document.createElement('div');
                    header.className = 'px-4 py-3 cursor-pointer flex justify-between items-center hover:bg-slate-50 transition select-none border-b border-slate-100/50';
                    header.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas ${config.icon} ${config.color} w-6 text-center mr-2"></i>
                            <span class="font-bold text-slate-700 text-sm">${tag}</span>
                            <span class="ml-2 text-xs bg-slate-100 text-slate-500 px-2 py-0.5 rounded-full">${groupItems.length}</span>
                        </div>
                        <i class="fas fa-chevron-down text-xs text-slate-300 transform transition-transform duration-300"></i>
                    `;

                    // Items Container (Accordion Body)
                    const body = document.createElement('div');
                    body.className = 'category-content bg-slate-50/50 open'; // Default open for better UX
                    
                    // Toggle Logic
                    header.onclick = () => {
                        body.classList.toggle('open');
                        const icon = header.querySelector('.fa-chevron-down');
                        icon.style.transform = body.classList.contains('open') ? 'rotate(0deg)' : 'rotate(-90deg)';
                    };

                    groupItems.forEach(attr => {
                        const item = document.createElement('div');
                        item.className = 'pl-12 pr-4 py-2 cursor-pointer transition flex items-center hover:bg-emerald-50 text-sm text-slate-600 border-l-2 border-transparent hover:border-emerald-400 group';
                        item.dataset.id = attr.id;
                        item.onclick = () => {
                            selectAttraction(attr.id);
                             // Close mobile menu if open
                            const mobileMenu = document.getElementById('mobile-menu');
                            if(!mobileMenu.classList.contains('hidden')) toggleMobileMenu();
                        };
                        item.innerHTML = `
                            <span class="truncate group-hover:text-emerald-700 transition">${attr.name}</span>
                        `;
                        body.appendChild(item);
                    });

                    container.appendChild(header);
                    container.appendChild(body);
                });
            };

            renderTarget(attractionList);
            renderTarget(mobileAttractionList);
        }


        // --- Initialize Map (Leaflet) ---
        function initMap() {
            // Center roughly on Taipei
            map = L.map('main-map').setView([25.06, 121.55], 12); 

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // Add Markers
            attractions.forEach(attr => {
                const marker = L.marker([attr.lat, attr.lng]).addTo(map);
                
                // Custom Popup
                const popupContent = `
                    <div class="text-center min-w-[150px]">
                        <h3 class="font-bold text-emerald-700 mb-1">${attr.name}</h3>
                        <p class="text-xs text-slate-500 mb-2">${attr.tag}</p>
                        <button onclick="selectAttraction('${attr.id}')" class="bg-emerald-500 text-white text-xs px-3 py-1 rounded hover:bg-emerald-600 transition w-full">
                            查看詳情
                        </button>
                    </div>
                `;
                marker.bindPopup(popupContent);
                markers.push(marker);
            });
        }

        // --- View Logic ---

        function showWelcomeScreen() {
             detailView.classList.add('hidden');
             welcomeScreen.classList.remove('hidden');
             headerTitle.innerText = "全區地圖總覽";
             
             // Deselect sidebar items
             document.querySelectorAll('.border-emerald-400').forEach(el => {
                el.classList.remove('bg-emerald-50', 'border-emerald-400', 'text-emerald-700', 'font-bold');
                el.classList.add('border-transparent');
             });

             // Resize map (needed if container size changed while hidden)
             setTimeout(() => {
                 map.invalidateSize();
                 // Reset view to cover all markers
                 const group = new L.featureGroup(markers);
                 map.fitBounds(group.getBounds().pad(0.1));
             }, 100);
        }

        function selectAttraction(id) {
            const attr = attractions.find(a => a.id === id);
            if (!attr) return;

            // Update Sidebar UI
            // Reset all
            const allItems = document.querySelectorAll('#attraction-list [data-id], #mobile-attraction-list [data-id]');
            allItems.forEach(el => {
                el.classList.remove('bg-emerald-50', 'border-emerald-400', 'text-emerald-700', 'font-bold');
                el.classList.add('border-transparent');
            });
            // Active
            const activeItems = document.querySelectorAll(`[data-id="${id}"]`);
            activeItems.forEach(el => {
                el.classList.add('bg-emerald-50', 'border-emerald-400', 'text-emerald-700', 'font-bold');
                el.classList.remove('border-transparent');
            });

            // Show Content
            welcomeScreen.classList.add('hidden');
            detailView.classList.remove('hidden');
            
            // Populate Data
            headerTitle.innerText = attr.name;
            elName.innerText = attr.name;
            elDesc.innerText = attr.desc;
            elHours.innerText = attr.hours;
            elPrice.innerText = attr.price;
            elAddress.innerText = attr.address;
            elMrt.innerText = attr.mrt;
            elBus.innerText = attr.bus;
            elTips.innerText = attr.tips;
            elTag.innerText = attr.tag;
            
            if(attr.weather) {
                elWeatherTip.innerText = `天氣/穿著：${attr.weather}`;
            } else {
                elWeatherTip.innerText = "天氣：12月台北濕冷，建議洋蔥式穿搭。";
            }

            // Image
            elImage.classList.add('opacity-0');
            const safeQuery = encodeURIComponent(attr.imagePrompt);
            const seed = Math.floor(Math.random() * 1000); 
            elImage.src = `https://image.pollinations.ai/prompt/${safeQuery}?width=1200&height=600&nologo=true&seed=${seed}&model=flux`;
            
            // Map Iframe (Detail view)
            const mapQ = encodeURIComponent(attr.mapQuery);
            elMapLink.href = `https://www.google.com/maps/search/?api=1&query=${mapQ}`;
            elMapIframe.src = `https://maps.google.com/maps?q=${mapQ}&t=&z=15&ie=UTF8&iwloc=&output=embed`;

            // Reset Scroll
            document.getElementById('content-area').scrollTop = 0;
            
            // Animation
            detailView.classList.remove('fade-in');
            void detailView.offsetWidth; 
            detailView.classList.add('fade-in');
        }

        // --- Mobile Menu Logic ---
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuContent = document.getElementById('mobile-menu-content');
        const closeMobileMenu = document.getElementById('close-mobile-menu');

        function toggleMobileMenu() {
            const isHidden = mobileMenu.classList.contains('hidden');
            if(isHidden) {
                mobileMenu.classList.remove('hidden');
                setTimeout(() => mobileMenuContent.classList.remove('-translate-x-full'), 10);
            } else {
                mobileMenuContent.classList.add('-translate-x-full');
                setTimeout(() => mobileMenu.classList.add('hidden'), 300);
            }
        }

        mobileMenuBtn.addEventListener('click', toggleMobileMenu);
        closeMobileMenu.addEventListener('click', toggleMobileMenu);
        mobileMenu.addEventListener('click', (e) => {
            if(e.target === mobileMenu) toggleMobileMenu();
        });

        // Search Listener
        searchInput.addEventListener('input', (e) => {
            renderList(e.target.value);
        });

        // --- Boot ---
        window.addEventListener('load', () => {
            renderList();
            initMap();
        });

    </script>
</body>
</html>