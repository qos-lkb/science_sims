<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾®ç”Ÿå¢ƒæ°£é«”å¾ªç’°æ¨¡æ“¬å¯¦é©—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* è‡ªå®šç¾©å‹•ç•«èˆ‡æ¨£å¼ */
        .sky-gradient {
            transition: background 1s ease;
        }
        .day-sky {
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
        }
        .night-sky {
            background: linear-gradient(to bottom, #0B1026, #2B32B2);
            color: white;
        }
        .bubble {
            position: absolute;
            bottom: 10px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: floatUp 4s infinite linear;
            opacity: 0;
        }
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 0.8; }
            100% { transform: translateY(-100px); opacity: 0; }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-800">

    <!-- é ‚éƒ¨æ¨™é¡Œ -->
    <header class="bg-teal-700 text-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold"><i class="fas fa-leaf mr-2"></i>å¾®ç”Ÿå¢ƒæ°£é«”å¾ªç’°æ¨¡æ“¬å™¨</h1>
            <span class="text-sm bg-teal-800 px-3 py-1 rounded-full">ç§‘å­¸å¯¦é©—æ¨¡æ“¬</span>
        </div>
    </header>

    <main class="container mx-auto p-4 grid grid-cols-1 lg:grid-cols-3 gap-6">

        <!-- å·¦å´ï¼šæ§åˆ¶èˆ‡è¦–è¦ºåŒ– -->
        <div class="lg:col-span-1 space-y-6">
            
            <!-- ç”Ÿæ…‹ç¼¸è¦–è¦ºåŒ– -->
            <div id="ecosystem-container" class="bg-white rounded-xl shadow-lg overflow-hidden border-4 border-gray-300 relative h-80 transition-colors duration-1000 day-sky">
                
                <!-- å¤©ç©ºç‹€æ…‹ (æ—¥/æœˆ) -->
                <div class="absolute top-4 right-4 text-5xl transition-all duration-1000" id="celestial-body">
                    â˜€ï¸
                </div>
                
                <!-- æ™‚é–“é¡¯ç¤º -->
                <div class="absolute top-4 left-4 bg-black/30 text-white px-3 py-1 rounded backdrop-blur-sm">
                    <div class="text-xs uppercase font-bold">æ™‚é–“</div>
                    <div class="text-xl font-mono" id="clock-display">06:00</div>
                </div>

                <!-- ç”Ÿç‰©å±¤ -->
                <div class="absolute bottom-0 w-full h-24 bg-amber-800 border-t-4 border-green-800 flex justify-around items-end px-4 pb-2">
                    <!-- æ¤ç‰©å€ -->
                    <div id="plants-container" class="flex space-x-2 text-4xl text-green-600">
                        <i class="fas fa-tree"></i><i class="fas fa-seedling"></i>
                    </div>
                    <!-- å‹•ç‰©å€ -->
                    <div id="animals-container" class="flex space-x-2 text-3xl text-gray-700">
                        <i class="fas fa-frog"></i>
                    </div>
                </div>

                <!-- æ°£æ³¡æ•ˆæœ (ç¤ºæ„æ°£é«”äº¤æ›) -->
                <div id="bubbles-layer" class="absolute inset-0 pointer-events-none overflow-hidden"></div>
                
                <!-- ç‹€æ…‹æ¨™ç±¤ -->
                <div class="absolute bottom-28 left-1/2 transform -translate-x-1/2 bg-white/80 px-4 py-2 rounded-lg shadow text-center w-3/4">
                    <p id="status-text" class="font-bold text-teal-700">æ­£åœ¨é€²è¡Œå…‰åˆä½œç”¨</p>
                    <p class="text-xs text-gray-600">æ·¨æ°£é«”è®ŠåŒ–</p>
                </div>
            </div>

            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-lg font-bold mb-4 border-b pb-2">å¯¦é©—åƒæ•¸è¨­å®š</h2>
                
                <div class="space-y-4">
                    <!-- æ’­æ”¾æ§åˆ¶ -->
                    <div class="flex space-x-2">
                        <button id="btn-play" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded transition" onclick="toggleSimulation()">
                            <i class="fas fa-play mr-2"></i>é–‹å§‹
                        </button>
                        <button class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 rounded transition" onclick="resetSimulation()">
                            <i class="fas fa-redo mr-2"></i>é‡ç½®
                        </button>
                    </div>

                    <div class="border-t pt-4">
                        <label class="block text-sm font-medium mb-1">æ¤ç‰©æ•¸é‡ (ç”Ÿç”¢è€…)</label>
                        <input type="range" id="plant-slider" min="1" max="10" value="5" class="w-full accent-green-600" oninput="updateSettings()">
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>å°‘</span>
                            <span id="plant-count">5</span>
                            <span>å¤š</span>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-1">å‹•ç‰©æ•¸é‡ (æ¶ˆè²»è€…)</label>
                        <input type="range" id="animal-slider" min="0" max="5" value="2" class="w-full accent-orange-600" oninput="updateSettings()">
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>ç„¡</span>
                            <span id="animal-count">2</span>
                            <span>å¤š</span>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-1">æ¨¡æ“¬é€Ÿåº¦</label>
                        <select id="speed-select" class="w-full border rounded p-2 bg-gray-50">
                            <option value="200">æ…¢é€Ÿ (ä»”ç´°è§€å¯Ÿ)</option>
                            <option value="100" selected>æ­£å¸¸</option>
                            <option value="20">å¿«é€Ÿ (è§€å¯Ÿè¶¨å‹¢)</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- å³å´ï¼šæ•¸æ“šåœ–è¡¨èˆ‡åˆ†æ -->
        <div class="lg:col-span-2 space-y-6">
            
            <!-- åœ–è¡¨å¡ç‰‡ -->
            <div class="bg-white p-4 rounded-xl shadow-lg h-96 flex flex-col">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-lg font-bold text-gray-700">æ°£é«”æ¿ƒåº¦è®ŠåŒ–è¶¨å‹¢åœ–</h2>
                    <div class="flex space-x-4 text-sm">
                        <div class="flex items-center"><span class="w-3 h-3 bg-blue-500 rounded-full mr-2"></span>æ°§æ°£ ($O_2$)</div>
                        <div class="flex items-center"><span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span>äºŒæ°§åŒ–ç¢³ ($CO_2$)</div>
                    </div>
                </div>
                <div class="flex-1 relative w-full">
                    <canvas id="gasChart"></canvas>
                </div>
            </div>

            <!-- å„€è¡¨æ¿æ•¸æ“š -->
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-blue-50 p-4 rounded-xl border border-blue-200 text-center">
                    <h3 class="text-gray-500 text-sm uppercase">ç•¶å‰æ°§æ°£æ¿ƒåº¦</h3>
                    <p class="text-3xl font-bold text-blue-600" id="o2-display">21.0%</p>
                    <p class="text-xs text-gray-400 mt-1">åˆå§‹å€¼: 21.0%</p>
                </div>
                <div class="bg-red-50 p-4 rounded-xl border border-red-200 text-center">
                    <h3 class="text-gray-500 text-sm uppercase">ç•¶å‰äºŒæ°§åŒ–ç¢³æ¿ƒåº¦</h3>
                    <p class="text-3xl font-bold text-red-600" id="co2-display">0.04%</p>
                    <p class="text-xs text-gray-400 mt-1">åˆå§‹å€¼: 0.04%</p>
                </div>
            </div>

            <!-- æ•™å­¸èªªæ˜ -->
            <div class="bg-yellow-50 p-5 rounded-xl border-l-4 border-yellow-400 text-sm">
                <h3 class="font-bold text-yellow-800 mb-2"><i class="fas fa-lightbulb mr-2"></i>è€å¸«çš„è§€å¯Ÿç­†è¨˜ï¼š</h3>
                <ul class="list-disc list-inside space-y-1 text-yellow-900">
                    <li><strong>ç™½å¤© (06:00 - 18:00)ï¼š</strong> å…‰åˆä½œç”¨é€Ÿç‡ > å‘¼å¸ä½œç”¨é€Ÿç‡ã€‚æ¤ç‰©é‡‹æ”¾æ°§æ°£ï¼Œå¸æ”¶äºŒæ°§åŒ–ç¢³ã€‚æ³¨æ„åœ–è¡¨ä¸­è—ç·šä¸Šå‡ï¼Œç´…ç·šä¸‹é™ã€‚</li>
                    <li><strong>å¤œæ™š (18:00 - 06:00)ï¼š</strong> å…‰åˆä½œç”¨åœæ­¢ã€‚æ¤ç‰©å’Œå‹•ç‰©éƒ½åªé€²è¡Œå‘¼å¸ä½œç”¨ï¼Œæ¶ˆè€—æ°§æ°£ä¸¦é‡‹æ”¾äºŒæ°§åŒ–ç¢³ã€‚æ³¨æ„åœ–è¡¨ä¸­è¶¨å‹¢åè½‰ã€‚</li>
                    <li><strong>è£œå„Ÿé»ï¼š</strong> é€™æ˜¯å…‰åˆä½œç”¨æ¶ˆè€—çš„ $CO_2$ èˆ‡å‘¼å¸ä½œç”¨ç”¢ç”Ÿçš„ $CO_2$ ç›¸ç­‰çš„æ™‚åˆ»ï¼ˆé€šå¸¸åœ¨é»æ˜å’Œé»ƒæ˜ï¼‰ã€‚</li>
                </ul>
            </div>

        </div>
    </main>

<script>
/**
 * æ¨¡æ“¬å™¨é‚è¼¯
 */

// ç‹€æ…‹è®Šæ•¸
let isRunning = false;
let timer = null;
let hour = 6; // å¾æ—©ä¸Š 6 é»é–‹å§‹
let minute = 0;
let dayCount = 1;

// åˆå§‹æ¿ƒåº¦ (æ¨¡æ“¬å€¼ï¼Œéåš´æ ¼å¤§æ°£çœŸå¯¦å€¼ï¼Œç‚ºäº†åœ–è¡¨æ˜é¡¯)
let o2 = 21.0; 
let co2 = 0.04;

// åƒæ•¸ä¿‚æ•¸ (å·²æ ¹æ“šç¾å¯¦èª¿æ•´ï¼Œå¤§å¹…é™ä½æ•¸å€¼)
const PHOTOSYNTHESIS_RATE = 0.008; // é™ä½ï¼šæ¯å–®ä½æ¤ç‰©æ¯å°æ™‚ç”¢ç”Ÿçš„ O2
const PLANT_RESPIRATION = 0.001;   // é™ä½ï¼šæ¯å–®ä½æ¤ç‰©æ¯å°æ™‚æ¶ˆè€—çš„ O2
const ANIMAL_RESPIRATION = 0.0035;  // é™ä½ï¼šæ¯å–®ä½å‹•ç‰©æ¯å°æ™‚æ¶ˆè€—çš„ O2

// ä½¿ç”¨è€…è¨­å®š
let numPlants = 5;
let numAnimals = 2;
let simulationSpeed = 100;

// Chart.js è¨­å®š
const ctx = document.getElementById('gasChart').getContext('2d');
const chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: [],
        datasets: [
            {
                label: 'æ°§æ°£ (O2)',
                data: [],
                borderColor: 'rgb(59, 130, 246)',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                tension: 0.4,
                yAxisID: 'y'
            },
            {
                label: 'äºŒæ°§åŒ–ç¢³ (CO2)',
                data: [],
                borderColor: 'rgb(239, 68, 68)',
                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                tension: 0.4,
                yAxisID: 'y1'
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: false,
        interaction: {
            mode: 'index',
            intersect: false,
        },
        plugins: {
            legend: { display: false },
            tooltip: {
                callbacks: {
                    title: (tooltipItems) => {
                        return `ç¬¬ ${dayCount} å¤© ${tooltipItems[0].label}`;
                    },
                    label: (context) => {
                        let label = context.dataset.label || '';
                        if (label) {
                            label += ': ';
                        }
                        if (context.parsed.y !== null) {
                            // å¢åŠ å°æ•¸é»ä½æ•¸ä»¥é¡¯ç¤ºå¾®å°è®ŠåŒ–
                            label += context.parsed.y.toFixed(4) + '%';
                        }
                        return label;
                    }
                }
            }
        },
        scales: {
            x: {
                title: { display: true, text: 'æ™‚é–“ (å°æ™‚)' },
                grid: { display: false }
            },
            y: {
                type: 'linear',
                display: true,
                position: 'left',
                title: { display: true, text: 'æ°§æ°£æ¿ƒåº¦ (%)' },
                // è®“ Y è»¸å‹•æ…‹é©æ‡‰ï¼Œä¸å†å›ºå®šå¤§ç¯„åœï¼Œä»¥ä¾¿è§€å¯Ÿå¾®å°è®ŠåŒ–
                suggestedMin: 20.8,
                suggestedMax: 21.2
            },
            y1: {
                type: 'linear',
                display: true,
                position: 'right',
                title: { display: true, text: 'CO2 æ¿ƒåº¦ (%)' },
                grid: { drawOnChartArea: false }, 
                // CO2 ç¯„åœèª¿æ•´ç‚ºæ›´ç²¾ç´°
                suggestedMin: 0,
                suggestedMax: 0.1
            }
        }
    }
});

// æ›´æ–° DOM å…ƒç´ 
const clockDisplay = document.getElementById('clock-display');
const container = document.getElementById('ecosystem-container');
const celestial = document.getElementById('celestial-body');
const statusText = document.getElementById('status-text');
const o2Display = document.getElementById('o2-display');
const co2Display = document.getElementById('co2-display');
const btnPlay = document.getElementById('btn-play');
const bubblesLayer = document.getElementById('bubbles-layer');

// åˆå§‹åŒ–åœ–è¡¨
function initChart() {
    // é å¡«å……å¹¾å€‹æ•¸æ“šé»è®“åœ–è¡¨ä¸ç©ºç™½
    addDataPoint(true);
}

// æ›´æ–°è¨­å®š
function updateSettings() {
    numPlants = parseInt(document.getElementById('plant-slider').value);
    numAnimals = parseInt(document.getElementById('animal-slider').value);
    simulationSpeed = parseInt(document.getElementById('speed-select').value);
    
    document.getElementById('plant-count').innerText = numPlants;
    document.getElementById('animal-count').innerText = numAnimals;

    // é‡æ–°ç¹ªè£½æ¤ç‰©
    const plantContainer = document.getElementById('plants-container');
    plantContainer.innerHTML = '';
    for(let i=0; i<numPlants; i++) {
        const icon = Math.random() > 0.5 ? '<i class="fas fa-tree"></i>' : '<i class="fas fa-seedling"></i>';
        plantContainer.innerHTML += icon;
    }

    // é‡æ–°ç¹ªè£½å‹•ç‰©
    const animalContainer = document.getElementById('animals-container');
    animalContainer.innerHTML = '';
    for(let i=0; i<numAnimals; i++) {
        const icons = ['<i class="fas fa-frog"></i>', '<i class="fas fa-crow"></i>', '<i class="fas fa-bug"></i>'];
        const icon = icons[Math.floor(Math.random() * icons.length)];
        animalContainer.innerHTML += icon;
    }

    // å¦‚æœæ­£åœ¨é‹è¡Œï¼Œæ›´æ–°è¨ˆæ™‚å™¨é€Ÿåº¦
    if (isRunning) {
        clearInterval(timer);
        timer = setInterval(tick, simulationSpeed);
    }
}

// ç”¢ç”Ÿæ°£æ³¡å‹•ç•«
function createBubbles(type) {
    if (Math.random() > 0.7) return; // ä¸è¦å¤ªé »ç¹

    const bubble = document.createElement('div');
    bubble.classList.add('bubble');
    
    // éš¨æ©Ÿä½ç½®
    const left = Math.random() * 100;
    bubble.style.left = `${left}%`;
    
    // å¤§å°
    const size = Math.random() * 10 + 5;
    bubble.style.width = `${size}px`;
    bubble.style.height = `${size}px`;

    // é¡è‰² (O2 è—è‰², CO2 ç´…è‰²)
    if (type === 'O2') {
        bubble.style.background = 'rgba(59, 130, 246, 0.6)';
    } else {
        bubble.style.background = 'rgba(239, 68, 68, 0.6)';
    }

    bubblesLayer.appendChild(bubble);

    // æ¸…é™¤ DOM
    setTimeout(() => {
        bubble.remove();
    }, 4000);
}

// æ ¸å¿ƒæ¨¡æ“¬é‚è¼¯ (æ¯ tick ä»£è¡¨ 10-15 åˆ†é˜)
function tick() {
    minute += 15;
    if (minute >= 60) {
        minute = 0;
        hour++;
        if (hour >= 24) {
            hour = 0;
            dayCount++;
        }
        // æ¯æ•´é»è¨˜éŒ„ä¸€æ¬¡æ•¸æ“š
        addDataPoint();
    }

    // åˆ¤æ–·æ—¥å¤œ (06:00 - 18:00 ç‚ºç™½å¤©)
    const isDay = hour >= 6 && hour < 18;

    // è¨ˆç®—è®ŠåŒ–é‡
    // å‘¼å¸ä½œç”¨ (24å°æ™‚é€²è¡Œ): æ¤ç‰© + å‹•ç‰©
    const totalRespiration = (numPlants * PLANT_RESPIRATION) + (numAnimals * ANIMAL_RESPIRATION);
    
    // å…‰åˆä½œç”¨ (åªåœ¨ç™½å¤©): æ¤ç‰©
    // é™åˆ¶å› å­ï¼šå¦‚æœ CO2 éä½ï¼Œå…‰åˆä½œç”¨æ•ˆç‡ä¸‹é™ (ç¾å¯¦æ¨¡æ“¬)
    let co2LimitingFactor = 1;
    if (co2 < 0.01) {
        co2LimitingFactor = co2 * 100; // ç•¶ CO2 < 0.01% æ™‚ï¼Œæ•ˆç‡ç·šæ€§ä¸‹é™
    }

    let currentPhotoRate = 0;
    if (isDay) {
        // å°‡ 6-18 æ˜ å°„åˆ° 0-PI
        const dayProgress = (hour - 6 + minute/60) / 12; // 0 to 1
        const sunIntensity = Math.sin(dayProgress * Math.PI); 
        currentPhotoRate = numPlants * PHOTOSYNTHESIS_RATE * sunIntensity * co2LimitingFactor;
    }

    // æ›´æ–°æ°£é«”
    // O2: +å…‰åˆ -å‘¼å¸
    let o2Change = currentPhotoRate - totalRespiration;
    // CO2: -å…‰åˆ +å‘¼å¸ (åå‘)
    let co2Change = totalRespiration - currentPhotoRate;

    // é˜»å°¼ä¿‚æ•¸ï¼šè®“æ¯æ¬¡ tick çš„è®ŠåŒ–æ›´å¹³æ»‘å¾®å°
    const DAMPING = 0.05; 

    o2 += o2Change * DAMPING; 
    co2 += co2Change * DAMPING;

    // é‚Šç•Œé™åˆ¶
    if (o2 < 0) o2 = 0;
    if (o2 > 30) o2 = 30; 
    if (co2 < 0) co2 = 0; // CO2 ä¸èƒ½ç‚ºè² 
    
    // æ›´æ–°è¦–è¦º
    updateVisuals(isDay, currentPhotoRate, totalRespiration);
}

function updateVisuals(isDay, photoRate, respRate) {
    // æ™‚é–“
    const hStr = hour.toString().padStart(2, '0');
    const mStr = minute.toString().padStart(2, '0');
    clockDisplay.innerText = `${hStr}:${mStr}`;

    // æ—¥å¤œåˆ‡æ›
    if (isDay) {
        container.classList.remove('night-sky');
        container.classList.add('day-sky');
        celestial.innerText = 'â˜€ï¸';
        
        // ç‹€æ…‹æ–‡å­—
        if (photoRate > respRate) {
            statusText.innerHTML = `<span class="text-blue-600"><i class="fas fa-arrow-up"></i> æ°§æ°£å¢åŠ </span> <span class="text-red-600 ml-2"><i class="fas fa-arrow-down"></i> CO2 æ¸›å°‘</span>`;
            createBubbles('O2');
        } else {
            // å‰›æ—¥å‡ºæˆ–æ—¥è½æ™‚å¯èƒ½å‘¼å¸å¤§æ–¼å…‰åˆ
            statusText.innerHTML = `<span class="text-gray-600">å…‰åˆä½œç”¨å¾®å¼± (è£œå„Ÿé»é™„è¿‘)</span>`;
        }
    } else {
        container.classList.remove('day-sky');
        container.classList.add('night-sky');
        celestial.innerText = 'ğŸŒ™';
        statusText.innerHTML = `<span class="text-blue-400"><i class="fas fa-arrow-down"></i> æ°§æ°£æ¸›å°‘</span> <span class="text-red-400 ml-2"><i class="fas fa-arrow-up"></i> CO2 å¢åŠ </span>`;
        createBubbles('CO2');
    }

    // æ•¸æ“šé¢æ¿ (å¢åŠ å°æ•¸ä½æ•¸é¡¯ç¤ºç²¾ç´°è®ŠåŒ–)
    o2Display.innerText = o2.toFixed(3) + '%';
    co2Display.innerText = co2.toFixed(4) + '%';
}

function addDataPoint(isInit = false) {
    const timeLabel = `${hour.toString().padStart(2, '0')}:00`;
    
    // é™åˆ¶åœ–è¡¨é¡¯ç¤ºçš„æ•¸æ“šé»æ•¸é‡ (ä¾‹å¦‚æœ€è¿‘ 48 é»)
    if (chart.data.labels.length > 48) {
        chart.data.labels.shift();
        chart.data.datasets[0].data.shift();
        chart.data.datasets[1].data.shift();
    }

    chart.data.labels.push(timeLabel);
    chart.data.datasets[0].data.push(o2);
    chart.data.datasets[1].data.push(co2);
    
    if (!isInit) {
        chart.update('none'); // none mode for performance
    } else {
        chart.update();
    }
}

// æ§åˆ¶åŠŸèƒ½
function toggleSimulation() {
    if (isRunning) {
        clearInterval(timer);
        btnPlay.innerHTML = '<i class="fas fa-play mr-2"></i>ç¹¼çºŒ';
        btnPlay.classList.remove('bg-red-600', 'hover:bg-red-700');
        btnPlay.classList.add('bg-green-600', 'hover:bg-green-700');
    } else {
        timer = setInterval(tick, simulationSpeed);
        btnPlay.innerHTML = '<i class="fas fa-pause mr-2"></i>æš«åœ';
        btnPlay.classList.remove('bg-green-600', 'hover:bg-green-700');
        btnPlay.classList.add('bg-red-600', 'hover:bg-red-700');
    }
    isRunning = !isRunning;
}

function resetSimulation() {
    clearInterval(timer);
    isRunning = false;
    hour = 6;
    minute = 0;
    dayCount = 1;
    o2 = 21.0;
    co2 = 0.04;
    
    // æ¸…ç©ºåœ–è¡¨
    chart.data.labels = [];
    chart.data.datasets[0].data = [];
    chart.data.datasets[1].data = [];
    
    btnPlay.innerHTML = '<i class="fas fa-play mr-2"></i>é–‹å§‹';
    btnPlay.classList.remove('bg-red-600', 'hover:bg-red-700');
    btnPlay.classList.add('bg-green-600', 'hover:bg-green-700');
    
    updateSettings(); // é‡ç¹ªç”Ÿç‰©
    updateVisuals(true, 0, 0);
    initChart();
    
    // Force update chart
    chart.update();
}

// åˆå§‹åŒ–
updateSettings();
updateVisuals(true, 0, 0);
initChart();

</script>
</body>
</html>