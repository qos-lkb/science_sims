<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­äºŒç§‘å­¸ - æ°£çƒé˜ç½©æ¨¡å‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Custom Glass Effect for the Jar */
        .glass-jar {
            background: linear-gradient(135deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.1) 100%);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-bottom: none;
            box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.5), 0 10px 20px rgba(0,0,0,0.1);
        }
        
        /* Balloon Animation smoothness */
        .balloon {
            transition: transform 0.1s ease-out;
            transform-origin: top center;
            /* Inverted pear shape (Wide top, narrow bottom) */
            border-radius: 50% 50% 50% 50% / 65% 65% 35% 35%;
        }

        /* Air particle animation */
        @keyframes flowDown {
            0% { transform: translateY(-20px); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(20px); opacity: 0; }
        }
        @keyframes flowUp {
            0% { transform: translateY(20px); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(-20px); opacity: 0; }
        }

        .air-in { animation: flowDown 0.8s infinite; }
        .air-out { animation: flowUp 0.8s infinite; }

        /* Modal Animation */
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-animate {
            animation: fadeInScale 0.3s ease-out forwards;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .noselect {
            -webkit-touch-callout: none; 
            -webkit-user-select: none; 
            -khtml-user-select: none; 
            -moz-user-select: none; 
            -ms-user-select: none; 
            user-select: none;
        }
    </style>
</head>
<body class="bg-slate-100 h-screen flex flex-col overflow-hidden noselect">

    <!-- Header -->
    <header class="bg-teal-600 text-white p-4 shadow-md flex-none z-10 relative">
        <div class="container mx-auto flex justify-between items-center pr-32">
            <div>
                <h1 class="text-xl md:text-2xl font-bold" data-i18n="title"><i class="fas fa-lungs mr-2"></i>å‘¼å¸æ©Ÿåˆ¶ - æ°£çƒé˜ç½©æ¨¡å‹</h1>
                <span class="text-sm opacity-80" data-i18n="subtitle">ä¸­äºŒç´šç§‘å­¸ - æ°£é«”äº¤æ›</span>
            </div>
        </div>
        
        <!-- Top Right Buttons -->
        <div class="absolute top-4 right-4 flex gap-2">
            <!-- Principles Button -->
            <button onclick="openModal()" class="bg-teal-700 hover:bg-teal-800 text-white font-bold py-1 px-3 rounded border border-teal-500 transition-colors text-sm flex items-center shadow-sm">
                <i class="fas fa-book-open mr-1"></i> <span data-i18n="btn_principles">åŸç†è§£èªª</span>
            </button>
            
            <!-- Language Switcher -->
            <button onclick="toggleLanguage()" class="bg-white/20 hover:bg-white/30 text-white font-bold py-1 px-3 rounded border border-white/40 transition-colors text-sm shadow-sm">
                <i class="fas fa-globe mr-1"></i> <span id="lang-btn-text">ä¸­ / EN</span>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow flex flex-col md:flex-row container mx-auto p-4 gap-4 h-full overflow-auto">
        
        <!-- Simulation Area (Left/Top) -->
        <div class="flex-1 bg-white rounded-2xl shadow-lg relative flex justify-center items-center p-4 min-h-[400px] md:min-h-0 overflow-visible">
            
            <!-- The Apparatus Container -->
            <div class="relative w-64 h-96 flex flex-col items-center">
                
                <!-- Tube (Trachea) -->
                <div class="w-4 h-16 bg-gray-300 absolute top-0 z-20 border-x-2 border-gray-400"></div>
                
                <!-- Air Flow Arrows (Dynamic) -->
                <div id="air-flow-indicator" class="absolute top-2 z-30 text-blue-600 text-xl font-bold opacity-0">
                    <i class="fas fa-arrow-down"></i>
                </div>

                <!-- Stopper -->
                <div class="w-16 h-4 bg-gray-800 absolute top-14 z-20 rounded"></div>

                <!-- The Bell Jar -->
                <div class="glass-jar w-full h-80 mt-16 rounded-t-[8rem] relative overflow-hidden z-10 flex justify-center">
                    
                    <!-- Internal Y-Tube -->
                    <div class="absolute top-0 w-4 h-10 bg-gray-300 border-x border-gray-400"></div>
                    <div class="absolute top-8 w-24 h-4 flex justify-between">
                        <!-- Left Branch -->
                        <div class="w-12 h-4 bg-gray-300 transform -rotate-45 origin-top-right border border-gray-400 rounded-full"></div>
                        <!-- Right Branch -->
                        <div class="w-12 h-4 bg-gray-300 transform rotate-45 origin-top-left border border-gray-400 rounded-full"></div>
                    </div>

                    <!-- Balloons (Lungs) -->
                    <div class="absolute top-16 w-full flex justify-center gap-4">
                        <div id="left-lung" class="balloon w-14 h-20 bg-pink-400 border border-pink-500 shadow-inner origin-top"></div>
                        <div id="right-lung" class="balloon w-14 h-20 bg-pink-400 border border-pink-500 shadow-inner origin-top"></div>
                    </div>
                </div>

                <!-- Diaphragm (Rubber Sheet) Area -->
                <div class="absolute bottom-0 w-full h-24 z-20">
                    <!-- SVG for the flexible rubber sheet -->
                    <svg width="100%" height="100%" viewBox="0 0 256 100" class="overflow-visible">
                        <!-- The Rubber Sheet Path -->
                        <path id="diaphragm-path" d="M0,0 Q128,-20 256,0 L256,10 L0,10 Z" fill="#fb923c" stroke="#c2410c" stroke-width="2" />
                        
                        <!-- The Knot/Handle Area -->
                        <g id="handle-group" transform="translate(128, -10)" style="cursor: ns-resize;">
                            <!-- Connection line -->
                            <line x1="0" y1="0" x2="0" y2="20" stroke="#c2410c" stroke-width="3" />
                            <!-- The Handle Knob -->
                            <circle cx="0" cy="25" r="12" fill="#be185d" stroke="#831843" stroke-width="2" class="shadow-lg hover:fill-pink-600 transition-colors"/>
                            <text x="0" y="29" text-anchor="middle" fill="white" font-size="10" font-weight="bold"><i class="fas fa-arrows-alt-v"></i></text>
                        </g>
                    </svg>
                </div>

                <!-- Labels Container -->
                <div class="absolute inset-0 pointer-events-none z-40">
                    
                    <!-- Label: Trachea (Pointing to Y-tube) -->
                    <div class="absolute top-6 left-[138px] flex items-center">
                        <div class="w-[118px] h-px bg-gray-500"></div>
                        <div class="ml-2 text-sm font-bold text-gray-700 bg-white/80 px-2 py-1 rounded shadow-sm whitespace-nowrap" data-i18n="trachea">
                            Yå½¢ç®¡ (æ°£ç®¡)
                        </div>
                    </div>

                    <!-- Label: Bell Jar (Pointing to glass) -->
                    <div class="absolute top-32 left-[245px] flex items-center">
                        <div class="w-[11px] h-px bg-gray-500"></div>
                        <div class="ml-2 text-sm font-bold text-gray-700 bg-white/80 px-2 py-1 rounded shadow-sm whitespace-nowrap" data-i18n="jar">
                            ç»ç’ƒé˜ç½© (èƒ¸è…”)
                        </div>
                    </div>

                    <!-- Label: Lungs (Pointing to Balloon) -->
                    <div class="absolute top-[170px] left-[192px] flex items-center">
                        <div class="w-[64px] h-px bg-gray-500"></div>
                        <div class="ml-2 text-sm font-bold text-gray-700 bg-white/80 px-2 py-1 rounded shadow-sm whitespace-nowrap" data-i18n="lungs">
                            æ°£çƒ (è‚º)
                        </div>
                    </div>

                    <!-- Label: Diaphragm (Pointing to sheet) - CORRECTED -->
                    <div class="absolute bottom-[88px] left-[200px] flex items-center">
                        <div class="w-[56px] h-px bg-gray-500"></div>
                        <div class="ml-2 text-sm font-bold text-gray-700 bg-white/80 px-2 py-1 rounded shadow-sm whitespace-nowrap" data-i18n="diaphragm">
                            è† è†œ (æ©«è†ˆè†œ)
                        </div>
                    </div>

                </div>
            </div>

            <!-- Drag Instruction -->
            <div class="absolute bottom-4 left-4 bg-yellow-100 text-yellow-800 px-3 py-1 rounded shadow text-sm animate-pulse z-50" id="instruction-badge" data-i18n="pull_instruction">
                <i class="fas fa-hand-pointer mr-1"></i> æ‹‰å‹•ç´…è‰²æ‰‹æŸ„
            </div>
        </div>

        <!-- Explanation Panel (Right/Bottom) -->
        <div class="w-full md:w-1/3 flex flex-col gap-4">
            
            <!-- 1. Physics Data Card (Now at Top) -->
            <div class="bg-white p-5 rounded-2xl shadow-lg flex-grow overflow-y-auto">
                <h3 class="text-lg font-bold text-teal-700 mb-4 border-b pb-2" data-i18n="principles_title">ç§‘å­¸åŸç†åˆ†æ</h3>
                
                <div class="space-y-4">
                    <!-- Volume -->
                    <div class="flex items-center justify-between">
                        <span class="font-semibold text-gray-700" data-i18n="vol_label">é˜ç½©å…§é«”ç© (Volume):</span>
                        <span id="vol-indicator" class="px-3 py-1 rounded-full bg-gray-100 text-gray-600 font-bold text-sm">ç¶­æŒä¸è®Š</span>
                    </div>
                    
                    <!-- Pressure -->
                    <div class="flex items-center justify-between">
                        <span class="font-semibold text-gray-700" data-i18n="pressure_label">é˜ç½©å…§æ°£å£“ (Pressure):</span>
                        <span id="pressure-indicator" class="px-3 py-1 rounded-full bg-gray-100 text-gray-600 font-bold text-sm">èˆ‡å¤§æ°£å¹³è¡¡</span>
                    </div>

                    <!-- Pressure Comparison -->
                    <div class="bg-blue-50 p-3 rounded-lg text-sm text-blue-800 mt-2">
                        <strong data-i18n="compare_label">æ¯”è¼ƒå¤§æ°£å£“å¼· (Atmospheric P.):</strong>
                        <p id="comparison-text" class="mt-1">
                            å…§éƒ¨æ°£å£“ = å¤§æ°£å£“å¼·ã€‚<br>
                            æ²’æœ‰ç©ºæ°£æ·¨æµå‹•ã€‚
                        </p>
                    </div>

                    <!-- Concept Mapping -->
                    <div class="mt-6">
                        <h4 class="font-bold text-sm text-gray-500 mb-2" data-i18n="relation_title">æ°£å£“èˆ‡æ°£æµé—œä¿‚:</h4>
                        <ul class="text-sm space-y-2 text-gray-700">
                            <li data-i18n="relation_inhale"><i class="fas fa-arrow-right text-teal-500 mr-2"></i>é«”ç©å¢åŠ  &rarr; æ°£å£“ä¸‹é™ &rarr; å¸æ°£</li>
                            <li data-i18n="relation_exhale"><i class="fas fa-arrow-right text-teal-500 mr-2"></i>é«”ç©æ¸›å°‘ &rarr; æ°£å£“ä¸Šå‡ &rarr; å‘¼æ°£</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 2. Status Card -->
            <div class="bg-white p-5 rounded-2xl shadow-lg border-l-8 border-gray-400 transition-colors duration-300" id="status-card">
                <h2 class="text-lg font-bold text-gray-600 mb-2" data-i18n="status_title">ç›®å‰ç‹€æ…‹</h2>
                <div class="text-3xl font-black text-gray-800 mb-1" id="status-text">éœæ­¢å¹³è¡¡</div>
                <div class="text-sm text-gray-500" id="status-sub">(Equilibrium)</div>
            </div>

            <!-- 3. Structure Comparison Table -->
            <div class="bg-white p-5 rounded-2xl shadow-lg border-l-8 border-teal-500">
                <h3 class="text-lg font-bold text-gray-700 mb-3" data-i18n="structure_title"><i class="fas fa-exchange-alt mr-2"></i>çµæ§‹å°ç…§</h3>
                <div class="grid grid-cols-2 gap-y-2 text-sm">
                    <div class="font-bold text-gray-500 border-b pb-1" data-i18n="model_part">æ¨¡å‹éƒ¨åˆ†</div>
                    <div class="font-bold text-gray-500 border-b pb-1" data-i18n="human_organ">äººé«”å™¨å®˜</div>
                    
                    <div class="text-gray-700 flex items-center"><span class="w-2 h-2 bg-gray-400 rounded-full mr-2"></span><span data-i18n="part_tube">Yå½¢ç®¡</span></div>
                    <div class="text-teal-700 font-bold" data-i18n="organ_tube">æ°£ç®¡ / æ”¯æ°£ç®¡</div>
                    
                    <div class="text-gray-700 flex items-center"><span class="w-2 h-2 bg-blue-200 border border-gray-400 mr-2"></span><span data-i18n="part_jar">ç»ç’ƒé˜ç½©</span></div>
                    <div class="text-teal-700 font-bold" data-i18n="organ_jar">èƒ¸è…” / è‚‹éª¨æ¶</div>
                    
                    <div class="text-gray-700 flex items-center"><span class="w-2 h-2 bg-pink-400 rounded-full mr-2"></span><span data-i18n="part_balloon">æ°£çƒ</span></div>
                    <div class="text-teal-700 font-bold" data-i18n="organ_balloon">è‚ºéƒ¨</div>
                    
                    <div class="text-gray-700 flex items-center"><span class="w-2 h-2 bg-orange-400 rounded-full mr-2"></span><span data-i18n="part_sheet">æ©¡çš®è† è†œ</span></div>
                    <div class="text-teal-700 font-bold" data-i18n="organ_sheet">æ©«è†ˆè†œ</div>
                </div>
            </div>

        </div>
    </main>

    <!-- Modal Overlay -->
    <div id="info-modal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex justify-center items-center backdrop-blur-sm transition-opacity duration-300">
        <!-- Modal Content -->
        <div class="bg-white rounded-xl shadow-2xl w-11/12 max-w-3xl p-6 relative flex flex-col max-h-[90vh] modal-animate">
            
            <!-- Close Button (Top Right) -->
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-800 text-2xl transition-colors z-10">
                <i class="fas fa-times-circle"></i>
            </button>

            <!-- Modal Header -->
            <div class="border-b pb-3 mb-4">
                <h2 class="text-2xl font-bold text-teal-700 flex items-center">
                    <i class="fas fa-book-open mr-2"></i> <span data-i18n="modal_title">å‘¼å¸æ©Ÿåˆ¶åŸç†è©³è§£</span>
                </h2>
            </div>

            <!-- Modal Body (Scrollable) -->
            <div class="overflow-y-auto pr-2 space-y-4 text-gray-700 leading-relaxed" data-i18n="modal_content">
                <!-- Content will be injected by JS -->
            </div>

            <!-- Modal Footer -->
            <div class="mt-6 pt-3 border-t text-right">
                <button onclick="closeModal()" class="bg-teal-600 text-white px-6 py-2 rounded-lg hover:bg-teal-700 transition shadow-md font-bold">
                    <span data-i18n="btn_close">é—œé–‰</span>
                </button>
            </div>
        </div>
    </div>

    <script>
    // Wrap in IIFE to prevent global namespace pollution
    (function() {
        // Translations
        const t = {
            zh: {
                title: '<i class="fas fa-lungs mr-2"></i>å‘¼å¸æ©Ÿåˆ¶ - æ°£çƒé˜ç½©æ¨¡å‹',
                subtitle: "ä¸­äºŒç´šç§‘å­¸ - æ°£é«”äº¤æ›",
                btn_principles: "åŸç†è§£èªª",
                trachea: "Yå½¢ç®¡ (æ°£ç®¡)",
                jar: "ç»ç’ƒé˜ç½© (èƒ¸è…”)",
                lungs: "æ°£çƒ (è‚º)",
                diaphragm: "è† è†œ (æ©«è†ˆè†œ)",
                pull_instruction: '<i class="fas fa-hand-pointer mr-1"></i> æ‹‰å‹•ç´…è‰²æ‰‹æŸ„',
                
                status_title: "ç›®å‰ç‹€æ…‹",
                status_rest: "éœæ­¢å¹³è¡¡",
                status_rest_sub: "(Equilibrium)",
                status_inhale: "æ­£åœ¨å¸æ°£ (Inhaling)",
                status_exhale: "æ­£åœ¨å‘¼æ°£ (Exhaling)",

                structure_title: '<i class="fas fa-exchange-alt mr-2"></i>çµæ§‹å°ç…§',
                model_part: "æ¨¡å‹éƒ¨åˆ†",
                human_organ: "äººé«”å™¨å®˜",
                part_tube: "Yå½¢ç®¡",
                organ_tube: "æ°£ç®¡ / æ”¯æ°£ç®¡",
                part_jar: "ç»ç’ƒé˜ç½©",
                organ_jar: "èƒ¸è…” / è‚‹éª¨æ¶",
                part_balloon: "æ°£çƒ",
                organ_balloon: "è‚ºéƒ¨",
                part_sheet: "æ©¡çš®è† è†œ",
                organ_sheet: "æ©«è†ˆè†œ",

                principles_title: "ç§‘å­¸åŸç†åˆ†æ",
                vol_label: "é˜ç½©å…§é«”ç© (Volume):",
                vol_increase: "æ­£åœ¨å¢åŠ  (Increasing)",
                vol_decrease: "æ­£åœ¨æ¸›å°‘ (Decreasing)",
                vol_constant: "ç¶­æŒä¸è®Š",
                
                pressure_label: "é˜ç½©å…§æ°£å£“ (Pressure):",
                pressure_drop: "æ­£åœ¨ä¸‹é™ (Dropping)",
                pressure_rise: "æ­£åœ¨ä¸Šå‡ (Rising)",
                pressure_balance: "å›å¾©å¹³è¡¡",
                
                compare_label: "æ¯”è¼ƒå¤§æ°£å£“å¼· (Atmospheric P.):",
                compare_less: "å…§éƒ¨æ°£å£“ <strong class='text-red-500'>ä½æ–¼ (<)</strong> å¤§æ°£å£“å¼·ã€‚<br>ç©ºæ°£æ­£æµå…¥è‚ºéƒ¨ã€‚",
                compare_more: "å…§éƒ¨æ°£å£“ <strong class='text-blue-500'>é«˜æ–¼ (>)</strong> å¤§æ°£å£“å¼·ã€‚<br>ç©ºæ°£æ­£æµå‡ºè‚ºéƒ¨ã€‚",
                compare_equal: "å…§éƒ¨æ°£å£“ <strong class='text-gray-500'>ç­‰æ–¼ (=)</strong> å¤§æ°£å£“å¼·ã€‚<br>æ²’æœ‰ç©ºæ°£æ·¨æµå‹•ã€‚",

                relation_title: "æ°£å£“èˆ‡æ°£æµé—œä¿‚:",
                relation_inhale: '<i class="fas fa-arrow-right text-teal-500 mr-2"></i>é«”ç©å¢åŠ  &rarr; æ°£å£“ä¸‹é™ &rarr; å¸æ°£',
                relation_exhale: '<i class="fas fa-arrow-right text-teal-500 mr-2"></i>é«”ç©æ¸›å°‘ &rarr; æ°£å£“ä¸Šå‡ &rarr; å‘¼æ°£',

                // Modal Translations
                modal_title: "å‘¼å¸æ©Ÿåˆ¶åŸç†è©³è§£",
                btn_close: "æ˜ç™½ï¼Œé—œé–‰",
                modal_content: `
                    <div class="space-y-4">
                        <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500">
                            <h3 class="font-bold text-lg text-blue-800 mb-2">ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µï¼šæ³¢ç¾©è€³å®šå¾‹ (Boyle's Law)</h3>
                            <p>åœ¨æº«åº¦ä¸è®Šçš„æƒ…æ³ä¸‹ï¼Œæ°£é«”çš„<strong>æ°£å£“ (Pressure)</strong> èˆ‡<strong>é«”ç© (Volume)</strong> æˆ<strong>åæ¯”</strong>ã€‚</p>
                            <p class="mt-2 text-sm text-blue-600">ç°¡å–®ä¾†èªªï¼šç©ºé–“è®Šå¤§ï¼Œæ°£å£“è®Šå°ï¼›ç©ºé–“è®Šå°ï¼Œæ°£å£“è®Šå¤§ã€‚</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                <h4 class="font-bold text-green-800 mb-2"><i class="fas fa-arrow-down mr-1"></i> å¸æ°£éç¨‹ (Inhalation)</h4>
                                <ol class="list-decimal list-inside space-y-1 text-sm text-gray-700">
                                    <li><strong>æ©«è†ˆè†œæ”¶ç¸®</strong>ä¸¦å‘ä¸‹ç§»å¹³ã€‚</li>
                                    <li>è‚‹éª¨æ¶å‘ä¸ŠåŠå‘å¤–ç§»å‹•ã€‚</li>
                                    <li>èƒ¸è…”<strong>é«”ç©å¢åŠ </strong>ã€‚</li>
                                    <li>è‚ºå…§<strong>æ°£å£“ä¸‹é™</strong> (ä½æ–¼å¤§æ°£å£“)ã€‚</li>
                                    <li>å¤–ç•Œç©ºæ°£è¢«è¿«æµå…¥è‚ºéƒ¨ã€‚</li>
                                </ol>
                            </div>

                            <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                                <h4 class="font-bold text-orange-800 mb-2"><i class="fas fa-arrow-up mr-1"></i> å‘¼æ°£éç¨‹ (Exhalation)</h4>
                                <ol class="list-decimal list-inside space-y-1 text-sm text-gray-700">
                                    <li><strong>æ©«è†ˆè†œæ”¾é¬†</strong>ä¸¦å›å½ˆæˆæ‹±å½¢ã€‚</li>
                                    <li>è‚‹éª¨æ¶å‘ä¸ŠåŠå‘å…§ç§»å‹•ã€‚</li>
                                    <li>èƒ¸è…”<strong>é«”ç©æ¸›å°‘</strong>ã€‚</li>
                                    <li>è‚ºå…§<strong>æ°£å£“ä¸Šå‡</strong> (é«˜æ–¼å¤§æ°£å£“)ã€‚</li>
                                    <li>è‚ºå…§ç©ºæ°£è¢«è¿«æ’å‡ºé«”å¤–ã€‚</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                `
            },
            en: {
                title: '<i class="fas fa-lungs mr-2"></i>Breathing Mech. - Bell Jar',
                subtitle: "Form 2 Science - Gas Exchange",
                btn_principles: "Principles",
                trachea: "Y-Tube (Trachea)",
                jar: "Bell Jar (Thoracic Cavity)",
                lungs: "Balloons (Lungs)",
                diaphragm: "Rubber Sheet (Diaphragm)",
                pull_instruction: '<i class="fas fa-hand-pointer mr-1"></i> Pull Red Handle',

                status_title: "Current Status",
                status_rest: "Equilibrium",
                status_rest_sub: "(Resting State)",
                status_inhale: "Inhaling",
                status_exhale: "Exhaling",

                structure_title: '<i class="fas fa-exchange-alt mr-2"></i>Comparison',
                model_part: "Model Part",
                human_organ: "Human Organ",
                part_tube: "Y-Tube",
                organ_tube: "Trachea / Bronchi",
                part_jar: "Bell Jar",
                organ_jar: "Thoracic Cavity",
                part_balloon: "Balloons",
                organ_balloon: "Lungs",
                part_sheet: "Rubber Sheet",
                organ_sheet: "Diaphragm",

                principles_title: "Scientific Principles",
                vol_label: "Volume inside Jar:",
                vol_increase: "Increasing",
                vol_decrease: "Decreasing",
                vol_constant: "Constant",
                
                pressure_label: "Pressure inside Jar:",
                pressure_drop: "Dropping",
                pressure_rise: "Rising",
                pressure_balance: "Balanced",
                
                compare_label: "vs Atmospheric Pressure:",
                compare_less: "Internal Pressure <strong class='text-red-500'>Lower (<)</strong>.<br>Air flows INTO lungs.",
                compare_more: "Internal Pressure <strong class='text-blue-500'>Higher (>)</strong>.<br>Air flows OUT of lungs.",
                compare_equal: "Internal Pressure <strong class='text-gray-500'>Equal (=)</strong>.<br>No net air flow.",

                relation_title: "Pressure & Airflow:",
                relation_inhale: '<i class="fas fa-arrow-right text-teal-500 mr-2"></i>Vol. Increase &rarr; Pressure Drop &rarr; Inhale',
                relation_exhale: '<i class="fas fa-arrow-right text-teal-500 mr-2"></i>Vol. Decrease &rarr; Pressure Rise &rarr; Exhale',

                // Modal Translations
                modal_title: "Mechanism Explained",
                btn_close: "Understood, Close",
                modal_content: `
                    <div class="space-y-4">
                        <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500">
                            <h3 class="font-bold text-lg text-blue-800 mb-2">ğŸ’¡ Key Concept: Boyle's Law</h3>
                            <p>For a fixed mass of gas at constant temperature, <strong>Pressure</strong> is <strong>inversely proportional</strong> to <strong>Volume</strong>.</p>
                            <p class="mt-2 text-sm text-blue-600">Simply put: Volume UP = Pressure DOWN; Volume DOWN = Pressure UP.</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                <h4 class="font-bold text-green-800 mb-2"><i class="fas fa-arrow-down mr-1"></i> Inhalation (Breathing In)</h4>
                                <ol class="list-decimal list-inside space-y-1 text-sm text-gray-700">
                                    <li><strong>Diaphragm contracts</strong> and flattens.</li>
                                    <li>Rib cage moves upwards and outwards.</li>
                                    <li>Thoracic cavity <strong>Volume INCREASES</strong>.</li>
                                    <li>Internal <strong>Pressure DECREASES</strong> (becomes lower than atmospheric pressure).</li>
                                    <li>Air is forced INTO the lungs.</li>
                                </ol>
                            </div>

                            <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                                <h4 class="font-bold text-orange-800 mb-2"><i class="fas fa-arrow-up mr-1"></i> Exhalation (Breathing Out)</h4>
                                <ol class="list-decimal list-inside space-y-1 text-sm text-gray-700">
                                    <li><strong>Diaphragm relaxes</strong> and returns to dome shape.</li>
                                    <li>Rib cage moves downwards and inwards.</li>
                                    <li>Thoracic cavity <strong>Volume DECREASES</strong>.</li>
                                    <li>Internal <strong>Pressure INCREASES</strong> (becomes higher than atmospheric pressure).</li>
                                    <li>Air is forced OUT of the lungs.</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                `
            }
        };

        // Current Language
        let currentLang = 'zh';

        // Elements
        const handleGroup = document.getElementById('handle-group');
        const diaphragmPath = document.getElementById('diaphragm-path');
        const leftLung = document.getElementById('left-lung');
        const rightLung = document.getElementById('right-lung');
        const statusCard = document.getElementById('status-card');
        const statusText = document.getElementById('status-text');
        const statusSub = document.getElementById('status-sub');
        const volIndicator = document.getElementById('vol-indicator');
        const pressureIndicator = document.getElementById('pressure-indicator');
        const comparisonText = document.getElementById('comparison-text');
        const flowIcon = document.getElementById('air-flow-indicator');
        const instructionBadge = document.getElementById('instruction-badge');
        const langBtnText = document.getElementById('lang-btn-text');
        const modal = document.getElementById('info-modal');

        // State variables
        let isDragging = false;
        let startY = 0;
        let prevClampedY = 0; 
        let flowTimeout = null; 
        
        // Config
        const baseControlY = -20; 
        const maxDown = 60; 
        const maxUp = -50; 

        // -- Modal Logic --
        window.openModal = function() {
            modal.classList.remove('hidden');
        }

        window.closeModal = function() {
            modal.classList.add('hidden');
        }

        // Close modal on clicking outside
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        // Language Toggle (Exposed to window for HTML click handler)
        window.toggleLanguage = function() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            updateStaticText();
            // Refresh dynamic status
            updateState(0); 
            if(!isDragging) setEquilibriumState();
        }

        function updateStaticText() {
            const dataElems = document.querySelectorAll('[data-i18n]');
            dataElems.forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[currentLang][key]) {
                    el.innerHTML = t[currentLang][key];
                }
            });
        }

        // Update UI based on vertical offset
        function updateSimulation(yOffset) {
            // 1. Clamp the value (Position logic)
            let clampedY = Math.max(maxUp, Math.min(maxDown, yOffset));
            
            // 2. Calculate delta (Movement/Flow logic)
            // Note: deltaY > 0 means moving DOWN (Inhaling)
            let deltaY = clampedY - prevClampedY;
            prevClampedY = clampedY;

            // 3. Update Visuals (Diaphragm shape & Lung size) - based on POSITION
            const currentControlY = baseControlY + (clampedY * 1.2); 
            const handleY = -10 + clampedY; 

            diaphragmPath.setAttribute('d', `M0,0 Q128,${currentControlY} 256,0 L256,10 L0,10 Z`);
            handleGroup.setAttribute('transform', `translate(128, ${handleY})`);

            // Lung size depends on displacement (position), not speed
            const scaleFactor = 1 + (clampedY / 120);
            leftLung.style.transform = `scale(${scaleFactor})`;
            rightLung.style.transform = `scale(${scaleFactor})`;

            // 4. Update Status Text & Flow Icons - based on DELTA (Movement)
            updateState(deltaY);

            // Remove instruction
            if (Math.abs(clampedY) > 5) {
                instructionBadge.style.display = 'none';
            }
        }

        function updateState(delta) {
            // Clear previous timeout
            if (flowTimeout) clearTimeout(flowTimeout);

            const threshold = 0.5; // Sensitivity threshold

            if (delta > threshold) {
                // Moving Down -> INHALING
                setInhalationState();
            } else if (delta < -threshold) {
                // Moving Up -> EXHALING
                setExhalationState();
            } 
            
            flowTimeout = setTimeout(() => {
                setEquilibriumState();
            }, 100); 
        }

        function setInhalationState() {
            const txt = t[currentLang];
            // Icon
            flowIcon.innerHTML = '<i class="fas fa-arrow-down"></i>';
            flowIcon.className = 'absolute top-2 z-30 text-blue-600 text-xl font-bold air-in';
            flowIcon.style.opacity = 1;

            // Panel
            statusCard.className = "bg-white p-5 rounded-2xl shadow-lg border-l-8 border-green-500 transition-colors duration-200";
            statusText.innerText = txt.status_inhale;
            statusText.className = "text-3xl font-black text-green-600 mb-1";
            statusSub.style.display = 'none'; // Simplify for dynamic
            
            volIndicator.innerText = txt.vol_increase;
            volIndicator.className = "px-3 py-1 rounded-full bg-green-100 text-green-700 font-bold text-sm";
            
            pressureIndicator.innerText = txt.pressure_drop;
            pressureIndicator.className = "px-3 py-1 rounded-full bg-blue-100 text-blue-700 font-bold text-sm";
            
            comparisonText.innerHTML = txt.compare_less;
        }

        function setExhalationState() {
            const txt = t[currentLang];
            // Icon
            flowIcon.innerHTML = '<i class="fas fa-arrow-up"></i>';
            flowIcon.className = 'absolute top-2 z-30 text-red-600 text-xl font-bold air-out';
            flowIcon.style.opacity = 1;

            // Panel
            statusCard.className = "bg-white p-5 rounded-2xl shadow-lg border-l-8 border-orange-500 transition-colors duration-200";
            statusText.innerText = txt.status_exhale;
            statusText.className = "text-3xl font-black text-orange-600 mb-1";
            statusSub.style.display = 'none';
            
            volIndicator.innerText = txt.vol_decrease;
            volIndicator.className = "px-3 py-1 rounded-full bg-orange-100 text-orange-700 font-bold text-sm";
            
            pressureIndicator.innerText = txt.pressure_rise;
            pressureIndicator.className = "px-3 py-1 rounded-full bg-red-100 text-red-700 font-bold text-sm";
            
            comparisonText.innerHTML = txt.compare_more;
        }

        function setEquilibriumState() {
            const txt = t[currentLang];
            // Icon
            flowIcon.style.opacity = 0;
            flowIcon.classList.remove('air-in', 'air-out');

            // Panel
            statusCard.className = "bg-white p-5 rounded-2xl shadow-lg border-l-8 border-gray-400 transition-colors duration-300";
            statusText.innerText = txt.status_rest;
            statusText.className = "text-3xl font-black text-gray-800 mb-1";
            statusSub.innerText = txt.status_rest_sub;
            statusSub.style.display = 'block';
            
            volIndicator.innerText = txt.vol_constant;
            volIndicator.className = "px-3 py-1 rounded-full bg-gray-100 text-gray-600 font-bold text-sm";
            
            pressureIndicator.innerText = txt.pressure_balance;
            pressureIndicator.className = "px-3 py-1 rounded-full bg-gray-100 text-gray-600 font-bold text-sm";
            
            comparisonText.innerHTML = txt.compare_equal;
        }

        // Mouse Events
        handleGroup.addEventListener('mousedown', (e) => {
            isDragging = true;
            startY = e.clientY;
        });

        window.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            
            const svgRect = document.querySelector('svg').getBoundingClientRect();
            const mouseY = e.clientY - svgRect.top; 
            
            let relativeY = mouseY - 25; 
            let offset = relativeY - 10; 
            
            updateSimulation(offset);
        });

        window.addEventListener('mouseup', () => {
            isDragging = false;
            setEquilibriumState();
        });

        // Touch Events (Mobile)
        handleGroup.addEventListener('touchstart', (e) => {
            isDragging = true;
            e.preventDefault(); 
        }, {passive: false});

        window.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            const touch = e.touches[0];
            const svgRect = document.querySelector('svg').getBoundingClientRect();
            const mouseY = touch.clientY - svgRect.top;
            let relativeY = mouseY - 25;
            let offset = relativeY - 10;
            updateSimulation(offset);
            e.preventDefault();
        }, {passive: false});

        window.addEventListener('touchend', () => {
            isDragging = false;
            setEquilibriumState();
        });
        
        // Initialize
        updateStaticText();
        updateSimulation(0);
        setEquilibriumState();
    })();
    </script>
</body>
</html>